---
phase: 05-text-input-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/java/com/dwc/laf/ui/DwcTextFieldBorder.java
  - src/test/java/com/dwc/laf/ui/DwcTextFieldBorderTest.java
  - src/main/resources/com/dwc/laf/token-mapping.properties
  - src/main/java/com/dwc/laf/DwcLookAndFeel.java
  - src/test/java/com/dwc/laf/DwcLookAndFeelTest.java
autonomous: true

must_haves:
  truths:
    - "DwcTextFieldBorder reserves space for focus ring + border + margin in its insets"
    - "DwcTextFieldBorder paints a rounded outline using the border color from UIDefaults"
    - "TextField hover and focus border colors are populated in UIDefaults from CSS tokens"
    - "TextFieldUI class default points to DwcTextFieldUI"
    - "TextField.border UIResource is a DwcTextFieldBorder instance"
  artifacts:
    - path: "src/main/java/com/dwc/laf/ui/DwcTextFieldBorder.java"
      provides: "Custom border with focus-width-aware insets and state-aware outline painting"
      min_lines: 70
    - path: "src/test/java/com/dwc/laf/ui/DwcTextFieldBorderTest.java"
      provides: "Tests for border insets and painting"
      min_lines: 40
  key_links:
    - from: "src/main/java/com/dwc/laf/DwcLookAndFeel.java"
      to: "DwcTextFieldBorder"
      via: "initTextFieldDefaults puts TextField.border as BorderUIResource"
      pattern: "TextField\\.border.*DwcTextFieldBorder"
    - from: "src/main/java/com/dwc/laf/DwcLookAndFeel.java"
      to: "DwcTextFieldUI"
      via: "initClassDefaults registers TextFieldUI"
      pattern: "TextFieldUI.*DwcTextFieldUI"
    - from: "src/main/resources/com/dwc/laf/token-mapping.properties"
      to: "UIDefaults"
      via: "hover border/background mappings for TextField"
      pattern: "TextField\\.hoverBorderColor"
---

<objective>
DwcTextFieldBorder with focus-width-aware insets and state-aware outline painting, token mapping updates for hover/focus states, and L&F registration for TextField delegate.

Purpose: Establishes the border, UIDefaults infrastructure, and L&F registration that the DwcTextFieldUI delegate (Plan 05-02) will rely on. Follows the same proven pattern from Phase 4 (DwcButtonBorder -> DwcButtonUI).

Output: DwcTextFieldBorder class, updated token-mapping.properties, TextFieldUI class default in DwcLookAndFeel, TextField.border UIResource.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-button-component/04-01-SUMMARY.md
@.planning/phases/05-text-input-components/05-RESEARCH.md
@src/main/java/com/dwc/laf/ui/DwcButtonBorder.java
@src/main/java/com/dwc/laf/DwcLookAndFeel.java
@src/main/resources/com/dwc/laf/token-mapping.properties
</context>

<tasks>

<task type="auto">
  <name>Task 1: DwcTextFieldBorder with focus-width-aware insets and state-aware outline painting</name>
  <files>
    src/main/java/com/dwc/laf/ui/DwcTextFieldBorder.java
    src/test/java/com/dwc/laf/ui/DwcTextFieldBorderTest.java
  </files>
  <action>
Create DwcTextFieldBorder extending AbstractBorder in the com.dwc.laf.ui package, following the DwcButtonBorder pattern but adapted for text fields.

**DwcTextFieldBorder structure:**
- DEFAULT_MARGIN = new Insets(2, 6, 2, 6) (text field uses tighter horizontal padding than button's 2,14,2,14)
- getBorderInsets(Component c, Insets insets):
  - Read Component.focusWidth and Component.borderWidth from UIManager
  - Check if c instanceof JTextComponent, read tc.getMargin() â€” if non-null and NOT UIResource, use it; otherwise use DEFAULT_MARGIN
  - insets = focusWidth + borderWidth + margin on all four sides
  - Return insets
- paintBorder(Component c, Graphics g, int x, int y, int width, int height):
  - Read Component.focusWidth, Component.borderWidth, TextField.arc from UIManager
  - Determine border color based on component state:
    1. If component is not enabled -> use TextField.borderColor (normal, will appear faded via disabled opacity on the whole component)
    2. If component hasFocus() -> use TextField.hoverBorderColor (DWC uses the primary/accent color for both hover AND focus border)
    3. If component has client property "DwcTextFieldUI.hover" == Boolean.TRUE -> use TextField.hoverBorderColor
    4. Otherwise -> use TextField.borderColor (normal state)
  - If borderColor is null, return early
  - Create Graphics2D via g.create(), try/finally with dispose
  - Call PaintUtils.setupPaintingHints, set color, call PaintUtils.paintOutline at (focusWidth, focusWidth, w-2*focusWidth, h-2*focusWidth, borderWidth, arc), then restorePaintingHints

NOTE: The hover state is communicated via a client property "DwcTextFieldUI.hover" (Boolean) because JTextComponent has no rollover model. The DwcTextFieldUI delegate (Plan 05-02) will set this property from its MouseListener. The border reads it to determine which color to use.

**Tests (DwcTextFieldBorderTest):**
- Test getBorderInsets returns focusWidth + borderWidth + margin on all sides (set Component.focusWidth=3, Component.borderWidth=1 in UIManager, verify insets are 3+1+2=6 top/bottom, 3+1+6=10 left/right)
- Test getBorderInsets respects application-set non-UIResource margin
- Test paintBorder does not throw (smoke test with a mock Graphics2D or real BufferedImage Graphics)
- Test paintBorder uses TextField.borderColor for normal state
- Test paintBorder uses TextField.hoverBorderColor when "DwcTextFieldUI.hover" client property is true

Use @BeforeEach/@AfterEach to save/restore UIManager L&F state (same pattern as DwcButtonBorderTest).
  </action>
  <verify>Run `mvn test -pl . -Dtest="DwcTextFieldBorderTest" -f /Users/beff/_lab/dwclaf/pom.xml` -- all tests pass.</verify>
  <done>DwcTextFieldBorder exists with focus-width-aware insets, state-aware border color resolution, and all tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Token mapping updates and TextField UIDefaults in DwcLookAndFeel</name>
  <files>
    src/main/resources/com/dwc/laf/token-mapping.properties
    src/main/java/com/dwc/laf/DwcLookAndFeel.java
    src/test/java/com/dwc/laf/DwcLookAndFeelTest.java
  </files>
  <action>
**Token mapping updates in token-mapping.properties:**

1. Remove `TextField.background` from the `--dwc-color-white` line (keep List.background, Table.background, TextArea.background). The `--dwc-input-background` mapping already maps to `TextField.background` and should win (the DWC input component token is more specific than the global white).

2. Remove the `--dwc-input-color = color:TextField.foreground` line entirely. The `currentColor` CSS value cannot be parsed. The `--dwc-color-black = color:TextField.foreground` line already provides the correct black foreground.

3. Add new mappings:
   ```
   --dwc-input-hover-border-color = color:TextField.hoverBorderColor
   --dwc-input-hover-background = color:TextField.hoverBackground
   ```

**DwcLookAndFeel updates:**

1. In initClassDefaults(), add:
   ```java
   table.put("TextFieldUI", "com.dwc.laf.ui.DwcTextFieldUI");
   ```

2. Create initTextFieldDefaults(UIDefaults table) method (same pattern as initButtonDefaults):
   - Set TextField.margin: new InsetsUIResource(2, 6, 2, 6)
   - Set TextField.border: new BorderUIResource(new DwcTextFieldBorder())

3. Call initTextFieldDefaults(table) from initComponentDefaults() AFTER initButtonDefaults(table).

4. Add import for DwcTextFieldBorder.

**Tests in DwcLookAndFeelTest:**
- Test that UIManager.getColor("TextField.hoverBorderColor") is non-null after L&F installation
- Test that UIManager.getColor("TextField.hoverBackground") is non-null after L&F installation
- Test that UIManager.getColor("TextField.background") is NOT white (#fff) but is the DWC input background color (light grayish blue from --dwc-input-background)
- Test that UIManager.get("TextField.border") is an instance of DwcTextFieldBorder (unwrap BorderUIResource if needed)
- Test that UIManager.get("TextField.margin") is InsetsUIResource(2,6,2,6)

Run full test suite to confirm no regressions.
  </action>
  <verify>Run `mvn test -f /Users/beff/_lab/dwclaf/pom.xml` -- all tests pass (including new ones and no regressions).</verify>
  <done>Token mappings fixed (no conflicting TextField.background from --dwc-color-white, --dwc-input-color removed, hover mappings added). TextFieldUI registered in initClassDefaults. TextField.border and TextField.margin installed in UIDefaults. All tests pass.</done>
</task>

</tasks>

<verification>
1. `mvn test -f /Users/beff/_lab/dwclaf/pom.xml` passes all tests
2. DwcTextFieldBorder.java exists with getBorderInsets and paintBorder methods
3. token-mapping.properties has hover border/background mappings and no conflicting TextField.background on --dwc-color-white
4. DwcLookAndFeel has TextFieldUI in initClassDefaults and initTextFieldDefaults method
5. UIManager.getColor("TextField.hoverBorderColor") returns a non-null Color after L&F installation
</verification>

<success_criteria>
- DwcTextFieldBorder correctly computes insets as focusWidth + borderWidth + margin
- DwcTextFieldBorder resolves border color based on hover/focus state
- Token mapping has no conflicts for TextField.background and includes hover state mappings
- TextFieldUI class default points to DwcTextFieldUI
- TextField.border is a DwcTextFieldBorder wrapped in BorderUIResource
- All tests pass with zero failures
</success_criteria>

<output>
After completion, create `.planning/phases/05-text-input-components/05-01-SUMMARY.md`
</output>
