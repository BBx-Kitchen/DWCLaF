---
phase: 06-selection-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/resources/com/dwc/laf/token-mapping.properties
  - src/main/java/com/dwc/laf/DwcLookAndFeel.java
  - src/main/java/com/dwc/laf/ui/DwcCheckBoxIcon.java
  - src/main/java/com/dwc/laf/ui/DwcRadioButtonIcon.java
  - src/main/java/com/dwc/laf/ui/DwcCheckBoxUI.java
  - src/main/java/com/dwc/laf/ui/DwcRadioButtonUI.java
  - src/test/java/com/dwc/laf/DwcLookAndFeelTest.java
  - src/test/java/com/dwc/laf/ui/DwcCheckBoxUITest.java
  - src/test/java/com/dwc/laf/ui/DwcRadioButtonUITest.java
autonomous: true

must_haves:
  truths:
    - "JCheckBox paints a custom checkmark icon (not system default) using DWC accent color for checked background"
    - "JCheckBox shows visually distinct states: normal (gray bg), hover (light bg + blue border), checked (blue bg + white checkmark), disabled (reduced opacity)"
    - "JRadioButton paints a custom circular indicator with center dot (not system default)"
    - "JRadioButton shows visually distinct states: normal (gray bg), hover (light bg + blue border), selected (blue bg + white dot), disabled (reduced opacity)"
    - "CheckBox and RadioButton icon colors derive from CSS design tokens via UIDefaults"
    - "ComboBox UIDefaults keys are populated from CSS tokens (ready for Plan 02)"
  artifacts:
    - path: "src/main/java/com/dwc/laf/ui/DwcCheckBoxIcon.java"
      provides: "Custom Icon painting checkbox indicator with checkmark path"
      min_lines: 80
    - path: "src/main/java/com/dwc/laf/ui/DwcRadioButtonIcon.java"
      provides: "Custom Icon painting circular radio indicator with center dot"
      min_lines: 80
    - path: "src/main/java/com/dwc/laf/ui/DwcCheckBoxUI.java"
      provides: "CheckBoxUI delegate registering custom icon"
      min_lines: 30
    - path: "src/main/java/com/dwc/laf/ui/DwcRadioButtonUI.java"
      provides: "RadioButtonUI delegate registering custom icon"
      min_lines: 30
  key_links:
    - from: "DwcLookAndFeel.initClassDefaults"
      to: "DwcCheckBoxUI, DwcRadioButtonUI, DwcComboBoxUI"
      via: "UIDefaults class name string registration"
      pattern: "CheckBoxUI.*DwcCheckBoxUI"
    - from: "DwcCheckBoxIcon.paintIcon"
      to: "UIManager colors"
      via: "UIManager.getColor/getInt for CheckBox.icon.* keys"
      pattern: "UIManager\\.getColor\\(\"CheckBox\\.icon\\."
    - from: "DwcRadioButtonIcon.paintIcon"
      to: "UIManager colors"
      via: "UIManager.getColor/getInt for RadioButton.icon.* keys"
      pattern: "UIManager\\.getColor\\(\"RadioButton\\.icon\\."
    - from: "token-mapping.properties"
      to: "CheckBox.icon.*, RadioButton.icon.*, ComboBox.* UIDefaults"
      via: "UIDefaultsPopulator mapping pipeline"
      pattern: "color:CheckBox\\.icon\\."
---

<objective>
Add token mappings for all Phase 6 components, register CheckBoxUI/RadioButtonUI/ComboBoxUI class defaults in DwcLookAndFeel, and implement custom DwcCheckBoxIcon/DwcRadioButtonIcon + DwcCheckBoxUI/DwcRadioButtonUI delegates that paint checkbox checkmarks and radio dots using DWC CSS token-derived colors.

Purpose: CheckBox and RadioButton are the first "icon-painting" components -- unlike Button (full paint override) and TextField (paintSafely override), these components delegate indicator painting to a custom Icon. This plan establishes the Icon-based painting pattern and populates all Phase 6 UIDefaults so the ComboBox delegate (Plan 02) can read its colors immediately.

Output: 4 new Java files (2 icons + 2 UI delegates), updated token-mapping.properties, updated DwcLookAndFeel with 3 new class defaults + 3 new init methods
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-selection-components/06-RESEARCH.md
@.planning/phases/04-button-component/04-01-SUMMARY.md
@.planning/phases/05-text-input-components/05-01-SUMMARY.md
@src/main/resources/com/dwc/laf/token-mapping.properties
@src/main/java/com/dwc/laf/DwcLookAndFeel.java
@src/main/java/com/dwc/laf/ui/DwcButtonUI.java
@src/main/java/com/dwc/laf/ui/DwcTextFieldBorder.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Token mappings and DwcLookAndFeel setup for CheckBox, RadioButton, and ComboBox</name>
  <files>
    src/main/resources/com/dwc/laf/token-mapping.properties
    src/main/java/com/dwc/laf/DwcLookAndFeel.java
    src/test/java/com/dwc/laf/DwcLookAndFeelTest.java
  </files>
  <action>
**token-mapping.properties** — Add these mappings (append to existing file, do NOT remove existing lines):

```properties
# Checkbox/Radio icon colors
--dwc-color-default = color:CheckBox.icon.background, color:RadioButton.icon.background
--dwc-color-default-dark = color:CheckBox.icon.borderColor, color:RadioButton.icon.borderColor
--dwc-color-default-light = color:CheckBox.icon.hoverBackground, color:RadioButton.icon.hoverBackground
--dwc-color-on-primary-text = color:CheckBox.icon.checkmarkColor, color:RadioButton.icon.dotColor
--dwc-color-primary = color:CheckBox.icon.selectedBackground, color:RadioButton.icon.selectedBackground, color:CheckBox.icon.selectedBorderColor, color:RadioButton.icon.selectedBorderColor
--dwc-color-primary-light = color:CheckBox.icon.hoverSelectedBackground, color:RadioButton.icon.hoverSelectedBackground

# ComboBox tokens
--dwc-input-background = color:ComboBox.background
--dwc-input-border-color = color:ComboBox.borderColor
--dwc-input-hover-border-color = color:ComboBox.hoverBorderColor
--dwc-color-body-text = color:ComboBox.foreground
--dwc-color-primary = color:ComboBox.selectionBackground
--dwc-color-on-primary-text = color:ComboBox.selectionForeground
--dwc-color-white = color:ComboBox.popupBackground
--dwc-color-default-dark = color:ComboBox.buttonArrowColor
```

IMPORTANT: Some of these tokens already have existing mapping lines (e.g., `--dwc-color-default` already maps to `Button.background, ToggleButton.background`). You must APPEND the new keys to those existing lines, not create duplicate lines. For example, the existing line:
```
--dwc-color-default = color:Button.background, color:ToggleButton.background
```
becomes:
```
--dwc-color-default = color:Button.background, color:ToggleButton.background, color:CheckBox.icon.background, color:RadioButton.icon.background
```

Similarly for `--dwc-color-default-dark`, `--dwc-color-default-light`, `--dwc-color-on-primary-text`, `--dwc-color-primary`, `--dwc-color-primary-light`, `--dwc-color-body-text`, `--dwc-color-white`, `--dwc-input-background`, `--dwc-input-border-color`, `--dwc-input-hover-border-color`.

The research identified that `--dwc-color-primary` is currently (incorrectly) mapped to `CheckBox.icon.checkmarkColor`. The checkmark color should be WHITE (--dwc-color-on-primary-text), not primary blue. Fix: remove `CheckBox.icon.checkmarkColor` from the `--dwc-color-primary` line and add it to the `--dwc-color-on-primary-text` line instead.

Also add hover border color for checkbox/radio (primary blue on hover):
```
--dwc-color-primary = ..., color:CheckBox.icon.hoverBorderColor, color:RadioButton.icon.hoverBorderColor
```

**DwcLookAndFeel.java** — Make these changes:

1. In `initClassDefaults()`, add three new entries:
```java
table.put("CheckBoxUI", "com.dwc.laf.ui.DwcCheckBoxUI");
table.put("RadioButtonUI", "com.dwc.laf.ui.DwcRadioButtonUI");
table.put("ComboBoxUI", "com.dwc.laf.ui.DwcComboBoxUI");
```

2. In `initComponentDefaults()`, add three new init calls after `initTextFieldDefaults(table)`:
```java
initCheckBoxDefaults(table);
initRadioButtonDefaults(table);
initComboBoxDefaults(table);
```

3. Add `initCheckBoxDefaults(UIDefaults table)` method:
   - Put `CheckBox.icon` -> `new DwcCheckBoxIcon()` (default icon for all checkboxes)
   - Put `CheckBox.margin` -> `new InsetsUIResource(2, 4, 2, 4)`
   - Put `CheckBox.rollover` -> `Boolean.TRUE`
   - Import DwcCheckBoxIcon

4. Add `initRadioButtonDefaults(UIDefaults table)` method:
   - Put `RadioButton.icon` -> `new DwcRadioButtonIcon()` (default icon for all radio buttons)
   - Put `RadioButton.margin` -> `new InsetsUIResource(2, 4, 2, 4)`
   - Put `RadioButton.rollover` -> `Boolean.TRUE`
   - Import DwcRadioButtonIcon

5. Add `initComboBoxDefaults(UIDefaults table)` method:
   - Put `ComboBox.border` -> `new BorderUIResource(new DwcTextFieldBorder())` (reuse existing border, per research recommendation)
   - Put `ComboBox.padding` -> `new InsetsUIResource(2, 6, 2, 6)` (same as TextField)
   - Log initialization

**DwcLookAndFeelTest.java** — Add tests verifying:
- `CheckBox.icon.background` is non-null Color after L&F init
- `CheckBox.icon.checkmarkColor` is white-ish (not primary blue — verifies the mapping fix)
- `RadioButton.icon.dotColor` is non-null Color
- `CheckBox.icon.selectedBackground` is non-null Color
- `ComboBox.background` is non-null Color
- `ComboBox.selectionBackground` is non-null Color
- CheckBoxUI class default is "com.dwc.laf.ui.DwcCheckBoxUI"
- RadioButtonUI class default is "com.dwc.laf.ui.DwcRadioButtonUI"
- ComboBoxUI class default is "com.dwc.laf.ui.DwcComboBoxUI"
  </action>
  <verify>Run `mvn test -pl . -Dtest=DwcLookAndFeelTest -q` and confirm all tests pass including the new ones.</verify>
  <done>Token-mapping.properties has checkbox/radio/combobox color mappings. DwcLookAndFeel registers CheckBoxUI, RadioButtonUI, ComboBoxUI class defaults and has init methods installing icon, margin, rollover, and border UIDefaults. CheckBox.icon.checkmarkColor maps to --dwc-color-on-primary-text (white), NOT --dwc-color-primary (blue).</done>
</task>

<task type="auto">
  <name>Task 2: DwcCheckBoxIcon, DwcRadioButtonIcon, DwcCheckBoxUI, and DwcRadioButtonUI</name>
  <files>
    src/main/java/com/dwc/laf/ui/DwcCheckBoxIcon.java
    src/main/java/com/dwc/laf/ui/DwcRadioButtonIcon.java
    src/main/java/com/dwc/laf/ui/DwcCheckBoxUI.java
    src/main/java/com/dwc/laf/ui/DwcRadioButtonUI.java
    src/test/java/com/dwc/laf/ui/DwcCheckBoxUITest.java
    src/test/java/com/dwc/laf/ui/DwcRadioButtonUITest.java
  </files>
  <action>
**DwcCheckBoxIcon.java** — Custom `Icon` implementation for JCheckBox indicator. Follow FlatLaf's `FlatCheckBoxIcon` architecture.

```java
public class DwcCheckBoxIcon implements Icon {
    private static final int ICON_SIZE = 16; // content area (excluding focus ring)
```

`getIconWidth()` / `getIconHeight()`: Return `ICON_SIZE + UIManager.getInt("Component.focusWidth") * 2` to reserve space for the focus ring.

`paintIcon(Component c, Graphics g, int x, int y)`:
1. Cast `c` to `AbstractButton`, get `ButtonModel`.
2. Determine state booleans: `selected = model.isSelected()`, `hover = model.isRollover()`, `pressed = model.isArmed() && model.isPressed()`, `focused = b.hasFocus()`, `enabled = b.isEnabled()`.
3. Read `int fw = UIManager.getInt("Component.focusWidth")`, `int bw = UIManager.getInt("Component.borderWidth")`, `int arc = UIManager.getInt("CheckBox.arc")`.
4. Compute indicator box position: `float bx = x + fw`, `float by = y + fw`.
5. Resolve background color:
   - If not enabled: use `CheckBox.icon.background`
   - If selected + hover: `CheckBox.icon.hoverSelectedBackground`
   - If selected: `CheckBox.icon.selectedBackground`
   - If hover or pressed: `CheckBox.icon.hoverBackground`
   - Else: `CheckBox.icon.background`
6. Resolve border color:
   - If not enabled: `CheckBox.icon.borderColor`
   - If selected: `CheckBox.icon.selectedBorderColor`
   - If hover or pressed: `CheckBox.icon.hoverBorderColor`
   - Else: `CheckBox.icon.borderColor`
7. Create `Graphics2D g2 = (Graphics2D) g.create()` in try-finally.
8. If disabled: apply `StateColorResolver.paintWithOpacity(g2, UIManager.getFloat("Component.disabledOpacity"))`.
9. Paint background: `PaintUtils.paintRoundedBackground(g2, bx, by, ICON_SIZE, ICON_SIZE, arc, bgColor)`.
10. Paint border outline: Use `PaintUtils.setupPaintingHints(g2)`, `PaintUtils.paintOutline(g2, bx, by, ICON_SIZE, ICON_SIZE, bw, arc)` with the resolved border color.
11. If selected, paint checkmark: Use `Path2D.Float` for the checkmark path. Scale from FlatLaf's 15px base to 16px: `moveTo(bx + 4.8f, by + 8.0f)`, `lineTo(bx + 7.04f, by + 10.67f)`, `lineTo(bx + 12.0f, by + 3.73f)`. Use `BasicStroke(2.0f, CAP_ROUND, JOIN_ROUND)`. Color from `UIManager.getColor("CheckBox.icon.checkmarkColor")` (should be white). Set antialiasing hints before drawing.
12. If focused and enabled, paint focus ring: `FocusRingPainter.paintFocusRing(g2, bx, by, ICON_SIZE, ICON_SIZE, arc, fw, UIManager.getColor("Component.focusRingColor"))`.
13. `g2.dispose()` in finally block.

**DwcRadioButtonIcon.java** — Custom `Icon` for JRadioButton indicator. Nearly identical to DwcCheckBoxIcon but:
- Uses `arc = ICON_SIZE` (full circle, since PaintUtils.createRoundedShape degenerates to Ellipse2D when arc >= diameter).
- Instead of checkmark Path2D, paints a center dot when selected: `Ellipse2D.Float` with diameter ~8px centered in the icon. Color from `UIManager.getColor("RadioButton.icon.dotColor")`.
- UIDefaults key prefix is `RadioButton.icon.*` instead of `CheckBox.icon.*`.
- Focus ring uses `arc = ICON_SIZE` for circular ring.

**DwcCheckBoxUI.java** — Minimal UI delegate:
```java
public class DwcCheckBoxUI extends BasicRadioButtonUI {
    public static ComponentUI createUI(JComponent c) {
        return new DwcCheckBoxUI(); // per-component instance
    }

    @Override
    public String getPropertyPrefix() {
        return "CheckBox.";
    }

    @Override
    protected void installDefaults(AbstractButton b) {
        super.installDefaults(b);
        LookAndFeel.installProperty(b, "opaque", false);
        b.setRolloverEnabled(true);
        // Icon is installed from UIDefaults by super.installDefaults
        // (reads CheckBox.icon key set in DwcLookAndFeel.initCheckBoxDefaults)
    }
}
```

**DwcRadioButtonUI.java** — Same structure as DwcCheckBoxUI but:
```java
public class DwcRadioButtonUI extends BasicRadioButtonUI {
    public static ComponentUI createUI(JComponent c) {
        return new DwcRadioButtonUI();
    }

    @Override
    public String getPropertyPrefix() {
        return "RadioButton.";
    }

    @Override
    protected void installDefaults(AbstractButton b) {
        super.installDefaults(b);
        LookAndFeel.installProperty(b, "opaque", false);
        b.setRolloverEnabled(true);
    }
}
```

**DwcCheckBoxUITest.java** — Tests:
- `createUI` returns per-component instances (not same reference)
- JCheckBox has DwcCheckBoxUI installed after L&F activation
- JCheckBox.isRolloverEnabled() returns true
- JCheckBox.isOpaque() returns false
- JCheckBox.getIcon() is instanceof DwcCheckBoxIcon
- Paint smoke test (create checkbox, set selected, call paint on BufferedImage -- no exceptions)
- Icon dimensions include focus width (getIconWidth > 16)

**DwcRadioButtonUITest.java** — Tests:
- Same pattern as checkbox tests but for JRadioButton/DwcRadioButtonUI/DwcRadioButtonIcon
- `createUI` returns per-component instances
- JRadioButton has DwcRadioButtonUI installed
- JRadioButton.isRolloverEnabled() returns true
- JRadioButton.isOpaque() returns false
- JRadioButton.getIcon() is instanceof DwcRadioButtonIcon
- Paint smoke test with selected state
  </action>
  <verify>Run `mvn test -q` and confirm ALL tests pass (existing + new). Verify the icon classes exist: `ls src/main/java/com/dwc/laf/ui/DwcCheckBoxIcon.java src/main/java/com/dwc/laf/ui/DwcRadioButtonIcon.java`.</verify>
  <done>DwcCheckBoxIcon paints rounded-rect box with Path2D checkmark on selected state using white checkmark color on blue background. DwcRadioButtonIcon paints circle with Ellipse2D center dot on selected state. Both icons handle all 4 visual states (normal/hover/selected/disabled) and paint focus rings. DwcCheckBoxUI and DwcRadioButtonUI extend BasicRadioButtonUI with per-component instances, opaque=false, rolloverEnabled=true. All tests pass.</done>
</task>

</tasks>

<verification>
1. `mvn test -q` — All tests pass (existing + new)
2. `ls src/main/java/com/dwc/laf/ui/Dwc{CheckBox,RadioButton}{Icon,UI}.java` — All 4 files exist
3. `grep "CheckBoxUI" src/main/java/com/dwc/laf/DwcLookAndFeel.java` — Shows registration
4. `grep "CheckBox.icon.checkmarkColor" src/main/resources/com/dwc/laf/token-mapping.properties` — Shows mapping to --dwc-color-on-primary-text (NOT --dwc-color-primary)
5. `grep "ComboBoxUI" src/main/java/com/dwc/laf/DwcLookAndFeel.java` — Shows registration (for Plan 02)
</verification>

<success_criteria>
- JCheckBox renders with custom DwcCheckBoxIcon (not system default)
- Checkbox icon shows 4 distinct visual states via color resolution
- JRadioButton renders with custom DwcRadioButtonIcon (circular, not system default)
- Radio icon shows 4 distinct visual states via color resolution
- Checkmark color is white (--dwc-color-on-primary-text), not primary blue
- All token mappings for checkbox, radio, AND combobox are in place
- CheckBoxUI, RadioButtonUI, ComboBoxUI class defaults registered in DwcLookAndFeel
</success_criteria>

<output>
After completion, create `.planning/phases/06-selection-components/06-01-SUMMARY.md`
</output>
