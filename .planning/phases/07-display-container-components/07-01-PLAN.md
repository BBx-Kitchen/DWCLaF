---
phase: 07-display-container-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/resources/com/dwc/laf/token-mapping.properties
  - src/main/java/com/dwc/laf/DwcLookAndFeel.java
  - src/main/java/com/dwc/laf/ui/DwcLabelUI.java
  - src/main/java/com/dwc/laf/ui/DwcPanelUI.java
  - src/test/java/com/dwc/laf/ui/DwcLabelUITest.java
  - src/test/java/com/dwc/laf/ui/DwcPanelUITest.java
  - src/test/java/com/dwc/laf/DwcLookAndFeelTest.java
autonomous: true

must_haves:
  truths:
    - "JLabel renders with typography tokens from CSS (font family, size, weight, color)"
    - "JLabel disabled state uses opacity reduction instead of chiseled text effect"
    - "JPanel background color derives from CSS surface token (Panel.background already mapped)"
    - "JPanel supports card-style rendering with rounded corners and elevation shadow when dwc.panelStyle=card"
    - "JPanel card mode is non-opaque for correct rounded corner rendering"
  artifacts:
    - path: "src/main/java/com/dwc/laf/ui/DwcLabelUI.java"
      provides: "LabelUI delegate with disabled opacity painting"
      min_lines: 40
    - path: "src/main/java/com/dwc/laf/ui/DwcPanelUI.java"
      provides: "PanelUI delegate with card-style rounded background and shadow"
      min_lines: 80
    - path: "src/test/java/com/dwc/laf/ui/DwcLabelUITest.java"
      provides: "Label UI tests"
      min_lines: 40
    - path: "src/test/java/com/dwc/laf/ui/DwcPanelUITest.java"
      provides: "Panel UI tests"
      min_lines: 60
  key_links:
    - from: "src/main/java/com/dwc/laf/DwcLookAndFeel.java"
      to: "DwcLabelUI, DwcPanelUI"
      via: "initClassDefaults and initPanelDefaults"
      pattern: "LabelUI.*DwcLabelUI|PanelUI.*DwcPanelUI"
    - from: "src/main/java/com/dwc/laf/ui/DwcPanelUI.java"
      to: "ShadowPainter, PaintUtils"
      via: "import and method calls in update()"
      pattern: "ShadowPainter\\.paintShadow|PaintUtils\\.paintRoundedBackground"
    - from: "src/main/resources/com/dwc/laf/token-mapping.properties"
      to: "UIDefaults Panel.arc, Panel.shadowColor etc."
      via: "token mapping pipeline"
      pattern: "Panel\\.arc|Panel\\.shadowColor"
---

<objective>
Implement DwcLabelUI and DwcPanelUI delegates with token mappings and L&F registration.

Purpose: JLabel gets proper disabled-state opacity rendering (no chiseled text), and JPanel gets card-style rendering with rounded corners and elevation shadow via client property activation. These are the two simpler components of Phase 7.

Output: Two new UI delegates (DwcLabelUI.java, DwcPanelUI.java), token mapping additions for Panel card properties, L&F registration, and tests.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-display-container-components/07-RESEARCH.md
@src/main/java/com/dwc/laf/DwcLookAndFeel.java
@src/main/java/com/dwc/laf/ui/DwcButtonUI.java
@src/main/java/com/dwc/laf/ui/DwcCheckBoxUI.java
@src/main/resources/com/dwc/laf/token-mapping.properties
@src/main/java/com/dwc/laf/painting/PaintUtils.java
@src/main/java/com/dwc/laf/painting/ShadowPainter.java
@src/main/java/com/dwc/laf/painting/StateColorResolver.java
@src/test/java/com/dwc/laf/ui/DwcComboBoxUITest.java
@src/test/java/com/dwc/laf/DwcLookAndFeelTest.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: DwcLabelUI + DwcPanelUI delegates, token mappings, and L&F registration</name>
  <files>
    src/main/resources/com/dwc/laf/token-mapping.properties
    src/main/java/com/dwc/laf/DwcLookAndFeel.java
    src/main/java/com/dwc/laf/ui/DwcLabelUI.java
    src/main/java/com/dwc/laf/ui/DwcPanelUI.java
  </files>
  <action>
    **DwcLabelUI.java** -- extend BasicLabelUI:
    - `createUI()` returns per-component instance (not shared singleton), matching all other delegates
    - Override `installDefaults(JLabel)`: call super, then `LookAndFeel.installProperty(l, "opaque", false)`
    - Override `paintDisabledText(JLabel, Graphics, String, int, int, int)`: instead of calling super (which paints chiseled light/dark text), use AlphaComposite with `Component.disabledOpacity` (read from UIManager, default 0.6f) to paint the text at reduced opacity using `g2.drawString()`. Read `Component.disabledOpacity` in a private `installDefaults` cached field.
    - Do NOT override `paint()` -- BasicLabelUI.paint() handles icon/text layout, mnemonic underlines, and accessibility correctly. Only the disabled text rendering needs fixing.

    **DwcPanelUI.java** -- extend BasicPanelUI:
    - `createUI()` returns per-component instance
    - Override `installDefaults(JPanel)`: call super, cache UIDefaults: `Panel.background`, `Panel.arc` (int, default 8), `Component.focusWidth` (int), `Panel.shadowColor` (Color, default new Color(0, 0, 0, 40)), `Panel.shadowBlurRadius` (int, default 6), `Panel.shadowOffsetY` (int, default 2)
    - Override `update(Graphics, JComponent)`:
      - Check `c.getClientProperty("dwc.panelStyle")` for "card" string
      - If NOT card mode: call `super.update(g, c)` (normal opaque fill + paint)
      - If card mode:
        1. Set component non-opaque if it isn't already (paint will not fill background)
        2. Create Graphics2D via g.create()
        3. Paint shadow using `ShadowPainter.paintShadow(g2, fw, fw, w - fw*2, h - fw*2, arc, blurRadius, 0, offsetY, shadowColor)` where fw = focusWidth (margin for shadow extent)
        4. Paint rounded background using `PaintUtils.paintRoundedBackground(g2, fw, fw, w - fw*2, h - fw*2, arc, background)`
        5. Dispose g2
        6. Call `paint(g, c)` to paint children (NOT super.update which would fill rectangular background)
    - Override `getInsets(JComponent)`: when card mode, return insets that include focusWidth on all sides (so children don't paint into shadow area). When not card mode, return super insets.

    **token-mapping.properties** -- add Panel card-mode token mappings:
    - `--dwc-border-radius-l` does not exist in CSS as a separate token. Instead, reuse existing `--dwc-border-radius` mapping which already maps to `Component.arc`. Add `int:Panel.arc` to the existing `--dwc-border-radius` line.
    - Add to existing `--dwc-color-default-dark` line: `color:Panel.shadowColor` (use as shadow color -- dark gray with some transparency, but the mapping gives us a base and we can add alpha in code)
    - Actually, Panel.shadowColor should be a semi-transparent dark color not directly from tokens. Hard-code it in `initPanelDefaults()` as `new Color(0, 0, 0, 40)` (CSS box-shadow: 0 2px 6px rgba(0,0,0,0.15) approximation). Do NOT add to token mapping.

    So for token-mapping.properties: only add `int:Panel.arc` to the existing `--dwc-border-radius` line.

    **DwcLookAndFeel.java** modifications:
    - Add to `initClassDefaults()`: `table.put("LabelUI", "com.dwc.laf.ui.DwcLabelUI")` and `table.put("PanelUI", "com.dwc.laf.ui.DwcPanelUI")`
    - Add new `initLabelDefaults(UIDefaults table)` method: no special defaults needed beyond what token mapping provides. Just a LOG.fine message. Call from initComponentDefaults.
    - Add new `initPanelDefaults(UIDefaults table)` method:
      - `table.put("Panel.arc", UIManager.getInt("Component.arc"))` -- inherit from Component.arc if Panel.arc not already set from token mapping
      - `table.put("Panel.shadowColor", new ColorUIResource(new Color(0, 0, 0, 40)))` -- semi-transparent black
      - `table.put("Panel.shadowBlurRadius", 6)`
      - `table.put("Panel.shadowOffsetY", 2)`
      - LOG.fine message
      - Call from `initComponentDefaults` after the existing init methods

    Commit: `feat(07-01): add DwcLabelUI and DwcPanelUI delegates with card-style shadow painting`
  </action>
  <verify>
    Run `mvn test -pl . -q` -- all existing tests pass (no regressions).
    Verify files exist: `ls src/main/java/com/dwc/laf/ui/DwcLabelUI.java src/main/java/com/dwc/laf/ui/DwcPanelUI.java`
  </verify>
  <done>
    DwcLabelUI extends BasicLabelUI with disabled opacity override. DwcPanelUI extends BasicPanelUI with card-mode shadow+rounded painting via dwc.panelStyle client property. Both registered in DwcLookAndFeel. All existing tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Tests for DwcLabelUI, DwcPanelUI, and L&F registration</name>
  <files>
    src/test/java/com/dwc/laf/ui/DwcLabelUITest.java
    src/test/java/com/dwc/laf/ui/DwcPanelUITest.java
    src/test/java/com/dwc/laf/DwcLookAndFeelTest.java
  </files>
  <action>
    **DwcLabelUITest.java** -- follow pattern from DwcComboBoxUITest (setUp/tearDown L&F save/restore):
    1. `createUI_returnsPerComponentInstances` -- two JLabels get different DwcLabelUI instances
    2. `label_hasCorrectUI` -- JLabel has DwcLabelUI installed
    3. `label_isNotOpaque` -- JLabel opaque is false after L&F installation
    4. `paintSmokeTest` -- create JLabel("Hello"), setSize(100,30), paint to BufferedImage, assert no throw and has non-transparent pixels
    5. `paintSmokeTest_disabled` -- create disabled JLabel, paint to BufferedImage, assert no throw
    6. `label_usesTokenFont` -- JLabel.getFont() is not null and matches UIManager.getFont("Label.font")
    7. `label_usesTokenForeground` -- JLabel.getForeground() matches UIManager.getColor("Label.foreground")

    **DwcPanelUITest.java** -- follow same setUp/tearDown pattern:
    1. `createUI_returnsPerComponentInstances` -- two JPanels get different DwcPanelUI instances
    2. `panel_hasCorrectUI` -- JPanel has DwcPanelUI installed
    3. `panel_backgroundFromToken` -- JPanel.getBackground() matches UIManager.getColor("Panel.background"), is a ColorUIResource
    4. `paintSmokeTest_defaultMode` -- create JPanel, setSize(200,200), paint to BufferedImage, no throw
    5. `paintSmokeTest_cardMode` -- create JPanel, putClientProperty("dwc.panelStyle", "card"), setSize(200,200), paint to BufferedImage, assert no throw and has non-transparent pixels
    6. `cardMode_isNotOpaque` -- set dwc.panelStyle=card, call panel.updateUI() or trigger update, verify opaque is false
    7. `panel_arcFromUIDefaults` -- UIManager.getInt("Panel.arc") is > 0
    8. `panel_shadowColorFromUIDefaults` -- UIManager.getColor("Panel.shadowColor") is not null

    **DwcLookAndFeelTest.java** -- add 2 tests at the end:
    - Test 30: `lafRegistersLabelUI` -- assert UIManager.get("LabelUI") equals "com.dwc.laf.ui.DwcLabelUI"
    - Test 31: `lafRegistersPanelUI` -- assert UIManager.get("PanelUI") equals "com.dwc.laf.ui.DwcPanelUI"

    Commit: `test(07-01): add DwcLabelUI and DwcPanelUI tests`
  </action>
  <verify>
    Run `mvn test -pl . -q` -- all tests pass including new ones.
    Count tests: `mvn test -pl . 2>&1 | grep "Tests run"` should show increased count.
  </verify>
  <done>
    7 DwcLabelUI tests + 8 DwcPanelUI tests + 2 L&F registration tests all pass. Total test count increased by 17. No regressions.
  </done>
</task>

</tasks>

<verification>
- `mvn test -pl . -q` passes with 0 failures
- `ls src/main/java/com/dwc/laf/ui/DwcLabelUI.java src/main/java/com/dwc/laf/ui/DwcPanelUI.java` both exist
- UIManager.get("LabelUI") returns "com.dwc.laf.ui.DwcLabelUI" after L&F activation
- UIManager.get("PanelUI") returns "com.dwc.laf.ui.DwcPanelUI" after L&F activation
- JLabel disabled painting uses opacity reduction (not chiseled effect)
- JPanel with dwc.panelStyle=card paints rounded background with shadow
</verification>

<success_criteria>
- DwcLabelUI installed for all JLabels, disabled text renders with reduced opacity
- DwcPanelUI installed for all JPanels, card mode renders rounded corners + shadow
- Panel.background derives from CSS surface token (--dwc-surface-3, already mapped)
- All tests pass (existing + 17 new)
- No regressions in other component delegates
</success_criteria>

<output>
After completion, create `.planning/phases/07-display-container-components/07-01-SUMMARY.md`
</output>
