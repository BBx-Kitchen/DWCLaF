---
phase: 07-display-container-components
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/main/resources/com/dwc/laf/token-mapping.properties
  - src/main/java/com/dwc/laf/DwcLookAndFeel.java
  - src/main/java/com/dwc/laf/ui/DwcTabbedPaneUI.java
  - src/test/java/com/dwc/laf/ui/DwcTabbedPaneUITest.java
  - src/test/java/com/dwc/laf/DwcLookAndFeelTest.java
autonomous: true

must_haves:
  truths:
    - "JTabbedPane tab strip styled with DWC tab appearance (underline active indicator, hover background)"
    - "JTabbedPane shows distinct tab states: normal, hover, selected, disabled"
    - "JTabbedPane content area has consistent background with panel styling"
    - "Selected tab has colored underline indicator below the tab text"
    - "Hovered tab shows subtle background tint and lighter text color"
    - "Disabled tabs render at reduced opacity"
  artifacts:
    - path: "src/main/java/com/dwc/laf/ui/DwcTabbedPaneUI.java"
      provides: "TabbedPaneUI delegate with underline indicator, hover, and state painting"
      min_lines: 180
    - path: "src/test/java/com/dwc/laf/ui/DwcTabbedPaneUITest.java"
      provides: "TabbedPane UI tests"
      min_lines: 80
  key_links:
    - from: "src/main/java/com/dwc/laf/DwcLookAndFeel.java"
      to: "DwcTabbedPaneUI"
      via: "initClassDefaults and initTabbedPaneDefaults"
      pattern: "TabbedPaneUI.*DwcTabbedPaneUI"
    - from: "src/main/java/com/dwc/laf/ui/DwcTabbedPaneUI.java"
      to: "PaintUtils, FocusRingPainter, StateColorResolver"
      via: "import and method calls"
      pattern: "PaintUtils\\.|FocusRingPainter\\.|StateColorResolver\\."
    - from: "src/main/resources/com/dwc/laf/token-mapping.properties"
      to: "UIDefaults TabbedPane.*"
      via: "token mapping pipeline"
      pattern: "TabbedPane\\."
---

<objective>
Implement DwcTabbedPaneUI delegate with DWC-style underline tab indicator, hover effects, distinct tab states, and consistent content area background.

Purpose: JTabbedPane is the most complex Phase 7 component. The delegate extends BasicTabbedPaneUI and overrides tab painting methods to render DWC-style tabs with a colored underline indicator for the selected tab, hover background tints, state-dependent text colors, and clean content area borders.

Output: DwcTabbedPaneUI.java with all tab state painting, token mapping additions for TabbedPane colors, L&F registration, and comprehensive tests.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-display-container-components/07-RESEARCH.md
@.planning/phases/07-display-container-components/07-01-SUMMARY.md
@src/main/java/com/dwc/laf/DwcLookAndFeel.java
@src/main/java/com/dwc/laf/ui/DwcButtonUI.java
@src/main/resources/com/dwc/laf/token-mapping.properties
@src/main/java/com/dwc/laf/painting/PaintUtils.java
@src/main/java/com/dwc/laf/painting/FocusRingPainter.java
@src/main/java/com/dwc/laf/painting/StateColorResolver.java
@src/test/java/com/dwc/laf/ui/DwcComboBoxUITest.java
@src/test/java/com/dwc/laf/DwcLookAndFeelTest.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: DwcTabbedPaneUI delegate, token mappings, and L&F registration</name>
  <files>
    src/main/resources/com/dwc/laf/token-mapping.properties
    src/main/java/com/dwc/laf/DwcLookAndFeel.java
    src/main/java/com/dwc/laf/ui/DwcTabbedPaneUI.java
  </files>
  <action>
    **token-mapping.properties** -- add TabbedPane color mappings:
    - Add to existing `--dwc-color-primary-text` line (which maps to `color:Button.default.background` etc.): NO -- `--dwc-color-primary-text` does NOT exist as a direct usable token. Instead use `--dwc-color-primary` for the underline/selected color, and `--dwc-color-body-text` for foreground.
    - Add to existing `--dwc-color-primary` line: `color:TabbedPane.selectedForeground, color:TabbedPane.underlineColor`
    - Add to existing `--dwc-color-primary-light` line: `color:TabbedPane.hoverForeground`
    - Add to existing `--dwc-color-body-text` line: `color:TabbedPane.foreground`
    - Add to existing `--dwc-color-default-dark` line: `color:TabbedPane.disabledForeground, color:TabbedPane.disabledUnderlineColor`
    - Add to existing `--dwc-color-default-light` line: `color:TabbedPane.hoverBackground`
    - Add to existing `--dwc-surface-3` line: `color:TabbedPane.background, color:TabbedPane.contentAreaColor`

    **DwcTabbedPaneUI.java** -- extend BasicTabbedPaneUI:
    - `createUI()` returns per-component instance
    - Override `installDefaults()`: call super, cache all TabbedPane colors from UIManager:
      - `foreground` = UIManager.getColor("TabbedPane.foreground")
      - `selectedForeground` = UIManager.getColor("TabbedPane.selectedForeground")
      - `hoverForeground` = UIManager.getColor("TabbedPane.hoverForeground")
      - `disabledForeground` = UIManager.getColor("TabbedPane.disabledForeground")
      - `underlineColor` = UIManager.getColor("TabbedPane.underlineColor")
      - `disabledUnderlineColor` = UIManager.getColor("TabbedPane.disabledUnderlineColor")
      - `hoverBackground` = UIManager.getColor("TabbedPane.hoverBackground")
      - `contentAreaColor` = UIManager.getColor("TabbedPane.contentAreaColor")
      - `focusRingColor` = UIManager.getColor("Component.focusRingColor")
      - `disabledOpacity` from UIManager.get("Component.disabledOpacity"), default 0.6f
      - `underlineHeight` = 3 (hardcoded, matches DWC tab indicator thickness)
      - `tabArc` = UIManager.getInt("Component.arc") (for hover background rounding)
    - Override `paintTabBackground(Graphics, int tabPlacement, int tabIndex, int x, int y, int w, int h, boolean isSelected)`:
      - If tab is NOT hovered and NOT selected: paint nothing (transparent background)
      - If tab IS hovered (check `getRolloverTab() == tabIndex`) and NOT selected: paint rounded rectangle with `hoverBackground` using `PaintUtils.paintRoundedBackground()` inset by 2px on each side for visual padding
      - If tab IS selected: paint nothing (selected state shown via underline, not background)
    - Override `paintTabBorder(Graphics, int tabPlacement, int tabIndex, int x, int y, int w, int h, boolean isSelected)`:
      - No-op -- DWC tabs have no individual tab borders
    - Override `paintFocusIndicator(Graphics, int tabPlacement, Rectangle[] rects, int tabIndex, Rectangle iconRect, Rectangle textRect, boolean isSelected)`:
      - If focused tab: paint focus ring using `FocusRingPainter.paintFocusRing()` around the tab rect with `focusRingColor`, arc = tabArc, ringWidth = 2 (thinner than Component.focusWidth for tabs)
    - Override `paintContentBorderTopEdge(Graphics, int tabPlacement, int selectedIndex, int x, int y, int w, int h)`:
      - Paint 1px separator line in contentAreaColor across the full width
      - If selectedIndex >= 0 and tabPlacement == TOP: paint underline indicator below the selected tab using `underlineColor`. The underline is `underlineHeight` pixels tall, positioned at y (the content border top), spanning the selected tab's width (from rects[selectedIndex].x to rects[selectedIndex].x + rects[selectedIndex].width). If the selected tab is disabled, use `disabledUnderlineColor`.
    - Override `paintContentBorderBottomEdge`, `paintContentBorderLeftEdge`, `paintContentBorderRightEdge`:
      - For the edge matching tabPlacement (e.g., BOTTOM edge when tabPlacement==BOTTOM): paint separator + underline same as top edge logic but at the correct edge position
      - For non-matching edges: paint 1px separator line in contentAreaColor, or no-op for clean look
    - Override `paintText(Graphics, int tabPlacement, Font font, FontMetrics metrics, int tabIndex, String title, Rectangle textRect, boolean isSelected)`:
      - Resolve text color based on state:
        - If `!tabPane.isEnabledAt(tabIndex)`: use disabledForeground with disabledOpacity
        - If `isSelected`: use selectedForeground
        - If `getRolloverTab() == tabIndex`: use hoverForeground (fallback to foreground)
        - Otherwise: use foreground
      - Call super.paintText with Graphics that has the resolved color set (via g.create() -> setColor -> paint -> dispose)
      - Handle mnemonic underline via `BasicGraphicsUtils.drawStringUnderlineCharAt`
    - Override `calculateTabAreaHeight/Width` if needed for proper spacing (likely not needed -- defaults work)
    - Set `tabInsets` to provide padding: `new Insets(8, 16, 8, 16)` in installDefaults via `UIManager.put` or by setting the protected field directly
    - Set `contentBorderInsets` to `new Insets(1, 0, 0, 0)` for minimal separator (just the top 1px line + underline)

    **DwcLookAndFeel.java** modifications (07-01 already added Label/Panel):
    - Add to `initClassDefaults()`: `table.put("TabbedPaneUI", "com.dwc.laf.ui.DwcTabbedPaneUI")`
    - Add `initTabbedPaneDefaults(UIDefaults table)` method:
      - `table.put("TabbedPane.tabInsets", new InsetsUIResource(8, 16, 8, 16))`
      - `table.put("TabbedPane.tabAreaInsets", new InsetsUIResource(0, 0, 0, 0))`
      - `table.put("TabbedPane.contentBorderInsets", new InsetsUIResource(0, 0, 0, 0))`
      - `table.put("TabbedPane.underlineHeight", 3)`
      - LOG.fine message
    - Call `initTabbedPaneDefaults(table)` from `initComponentDefaults()` after existing init methods

    Commit: `feat(07-02): add DwcTabbedPaneUI delegate with underline indicator and hover states`
  </action>
  <verify>
    Run `mvn test -pl . -q` -- all existing tests pass (no regressions).
    Verify file exists: `ls src/main/java/com/dwc/laf/ui/DwcTabbedPaneUI.java`
  </verify>
  <done>
    DwcTabbedPaneUI extends BasicTabbedPaneUI with: transparent tab backgrounds (hover gets tinted), no tab borders, colored underline indicator for selected tab, state-dependent text colors (normal/hover/selected/disabled), focus ring on focused tab, minimal content border. Registered in DwcLookAndFeel. All existing tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Tests for DwcTabbedPaneUI and L&F registration</name>
  <files>
    src/test/java/com/dwc/laf/ui/DwcTabbedPaneUITest.java
    src/test/java/com/dwc/laf/DwcLookAndFeelTest.java
  </files>
  <action>
    **DwcTabbedPaneUITest.java** -- follow pattern from DwcComboBoxUITest (setUp/tearDown L&F save/restore):
    1. `createUI_returnsPerComponentInstances` -- two JTabbedPanes get different DwcTabbedPaneUI instances
    2. `tabbedPane_hasCorrectUI` -- JTabbedPane has DwcTabbedPaneUI installed
    3. `tabbedPane_hasTokenForeground` -- JTabbedPane foreground matches UIManager.getColor("TabbedPane.foreground")
    4. `paintSmokeTest_withTabs` -- create JTabbedPane, add 3 tabs (JPanel children), setSelectedIndex(0), setSize(400, 300), paint to BufferedImage, assert no throw and has non-transparent pixels
    5. `paintSmokeTest_noTabs` -- create empty JTabbedPane, setSize(400, 300), paint to BufferedImage, assert no throw
    6. `paintSmokeTest_disabledTab` -- create JTabbedPane with 2 tabs, setEnabledAt(1, false), setSize(400, 300), paint to BufferedImage, assert no throw
    7. `paintSmokeTest_selectedTab` -- create JTabbedPane with 3 tabs, setSelectedIndex(2), setSize(400, 300), paint to BufferedImage, assert no throw and has content
    8. `underlineColor_fromUIDefaults` -- UIManager.getColor("TabbedPane.underlineColor") is not null, is ColorUIResource
    9. `selectedForeground_fromUIDefaults` -- UIManager.getColor("TabbedPane.selectedForeground") is not null
    10. `hoverBackground_fromUIDefaults` -- UIManager.getColor("TabbedPane.hoverBackground") is not null
    11. `contentAreaColor_fromUIDefaults` -- UIManager.getColor("TabbedPane.contentAreaColor") is not null
    12. `tabbedPane_tabInsets` -- UIManager.getInsets("TabbedPane.tabInsets") equals (8, 16, 8, 16)

    **DwcLookAndFeelTest.java** -- add 1 test at the end (after tests 30-31 from Plan 01):
    - Test 32: `lafRegistersTabbedPaneUI` -- assert UIManager.get("TabbedPaneUI") equals "com.dwc.laf.ui.DwcTabbedPaneUI"

    Commit: `test(07-02): add DwcTabbedPaneUI tests for tab states, painting, and token mappings`
  </action>
  <verify>
    Run `mvn test -pl . -q` -- all tests pass including new ones.
    Count tests: `mvn test -pl . 2>&1 | grep "Tests run"` should show increased count from Plan 01.
  </verify>
  <done>
    12 DwcTabbedPaneUI tests + 1 L&F registration test all pass. Total test count increased by 13 from Plan 01 baseline. No regressions. Phase 7 complete -- all 3 component delegates (Label, Panel, TabbedPane) implemented and tested.
  </done>
</task>

</tasks>

<verification>
- `mvn test -pl . -q` passes with 0 failures
- `ls src/main/java/com/dwc/laf/ui/DwcTabbedPaneUI.java` exists
- UIManager.get("TabbedPaneUI") returns "com.dwc.laf.ui.DwcTabbedPaneUI" after L&F activation
- JTabbedPane with tabs shows underline on selected tab
- JTabbedPane hover tab gets background tint
- JTabbedPane disabled tab renders at reduced opacity
- TabbedPane.underlineColor, TabbedPane.selectedForeground, TabbedPane.hoverBackground all populated in UIDefaults
</verification>

<success_criteria>
- DwcTabbedPaneUI installed for all JTabbedPanes
- Selected tab has colored underline indicator (primary color)
- Hovered tab has subtle background tint and lighter text
- Disabled tabs render at reduced opacity
- Content area background matches panel styling (--dwc-surface-3)
- All tests pass (existing + 13 new)
- No regressions in other component delegates
- Phase 7 fully complete: Label + Panel + TabbedPane
</success_criteria>

<output>
After completion, create `.planning/phases/07-display-container-components/07-02-SUMMARY.md`
</output>
