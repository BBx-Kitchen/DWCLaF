---
phase: 09-button-theme-variants-custom-css-themes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/resources/com/dwc/laf/token-mapping.properties
  - src/main/java/com/dwc/laf/DwcLookAndFeel.java
  - src/main/java/com/dwc/laf/ui/DwcButtonUI.java
  - src/main/java/com/dwc/laf/ui/DwcButtonBorder.java
  - src/test/java/com/dwc/laf/ui/DwcButtonUITest.java
autonomous: true

must_haves:
  truths:
    - "putClientProperty('dwc.buttonType', 'success') produces a button with green background from --dwc-color-success token"
    - "putClientProperty('dwc.buttonType', 'danger') produces a button with red background from --dwc-color-danger token"
    - "putClientProperty('dwc.buttonType', 'warning') produces a button with amber background from --dwc-color-warning token"
    - "putClientProperty('dwc.buttonType', 'info') produces a button with info-colored background from --dwc-color-info token"
    - "Each variant's border color matches its variant color (not default gray)"
    - "Each variant's focus ring color is computed from its own HSL hue/saturation (not primary blue)"
    - "Existing primary and default button variants still work unchanged"
  artifacts:
    - path: "src/main/resources/com/dwc/laf/token-mapping.properties"
      provides: "Button.success.*, Button.danger.*, Button.warning.*, Button.info.* UIDefaults key mappings from CSS semantic tokens"
      contains: "Button.success.background"
    - path: "src/main/java/com/dwc/laf/DwcLookAndFeel.java"
      provides: "Per-variant focus ring color computation using --dwc-color-{variant}-h/s tokens"
      contains: "Component.focusRingColor."
    - path: "src/main/java/com/dwc/laf/ui/DwcButtonUI.java"
      provides: "Variant-keyed color resolution using VariantColors record and Map lookup"
      contains: "VariantColors"
    - path: "src/main/java/com/dwc/laf/ui/DwcButtonBorder.java"
      provides: "Variant-aware border color lookup via dwc.buttonType client property"
      contains: "dwc.buttonType"
    - path: "src/test/java/com/dwc/laf/ui/DwcButtonUITest.java"
      provides: "Tests for all 4 new variant smoke paints and variant color resolution"
      min_lines: 160
  key_links:
    - from: "src/main/resources/com/dwc/laf/token-mapping.properties"
      to: "UIDefaults"
      via: "UIDefaultsPopulator.populate() reads token-mapping.properties"
      pattern: "Button\\.success\\."
    - from: "src/main/java/com/dwc/laf/ui/DwcButtonUI.java"
      to: "UIManager.getColor"
      via: "installDefaults reads Button.{variant}.* keys into VariantColors map"
      pattern: "variantColors"
    - from: "src/main/java/com/dwc/laf/ui/DwcButtonBorder.java"
      to: "UIManager.getColor"
      via: "paintBorder reads dwc.buttonType and looks up Button.{variant}.borderColor"
      pattern: "dwc\\.buttonType"
    - from: "src/main/java/com/dwc/laf/DwcLookAndFeel.java"
      to: "CssTokenMap"
      via: "initVariantFocusRingColors loops over variant names reading --dwc-color-{variant}-h/s"
      pattern: "focusRingColor"
---

<objective>
Add success/danger/warning/info button variant infrastructure: token mappings, per-variant focus ring colors, variant-keyed DwcButtonUI refactor, and variant-aware DwcButtonBorder.

Purpose: Enable JButton to render with semantic color variants (green/red/amber/info) by reading variant-specific UIDefaults keys populated from CSS tokens, matching the DWC web component button-theme-generator pattern.

Output: Token mapping entries, per-variant focus ring colors in UIDefaults, refactored DwcButtonUI with VariantColors record and Map-based lookup, variant-aware DwcButtonBorder, and tests.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-button-theme-variants-custom-css-themes/09-RESEARCH.md
@.planning/phases/04-button-component/04-01-SUMMARY.md
@.planning/phases/04-button-component/04-02-SUMMARY.md
@src/main/resources/com/dwc/laf/token-mapping.properties
@src/main/java/com/dwc/laf/DwcLookAndFeel.java
@src/main/java/com/dwc/laf/ui/DwcButtonUI.java
@src/main/java/com/dwc/laf/ui/DwcButtonBorder.java
@src/main/java/com/dwc/laf/painting/StateColorResolver.java
@src/test/java/com/dwc/laf/ui/DwcButtonUITest.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Token mappings and per-variant focus ring colors</name>
  <files>
    src/main/resources/com/dwc/laf/token-mapping.properties
    src/main/java/com/dwc/laf/DwcLookAndFeel.java
  </files>
  <action>
**token-mapping.properties:** Add variant-specific UIDefaults key mappings for all 4 variants. IMPORTANT: some CSS tokens already have existing mappings (e.g., `--dwc-color-danger` already maps to `color:TextField.errorBorderColor, color:Component.error.focusedBorderColor`). For those, APPEND the new button key as an additional comma-separated target. For tokens not yet mapped, add new lines. Follow the exact CSS semantic alias pattern from the research:

```properties
# SUCCESS button variant
--dwc-color-success = color:Button.success.background
--dwc-color-on-success-text = color:Button.success.foreground
--dwc-color-success-light = color:Button.success.hoverBackground
--dwc-color-success-dark = color:Button.success.pressedBackground
--dwc-border-color-success = color:Button.success.borderColor

# DANGER button variant (APPEND to existing --dwc-color-danger line)
# --dwc-color-danger already has: color:TextField.errorBorderColor, color:Component.error.focusedBorderColor
# Append: , color:Button.danger.background
--dwc-color-on-danger-text = color:Button.danger.foreground
--dwc-color-danger-light = color:Button.danger.hoverBackground
--dwc-color-danger-dark = color:Button.danger.pressedBackground
--dwc-border-color-danger = color:Button.danger.borderColor

# WARNING button variant
--dwc-color-warning = color:Button.warning.background
--dwc-color-on-warning-text = color:Button.warning.foreground
--dwc-color-warning-light = color:Button.warning.hoverBackground
--dwc-color-warning-dark = color:Button.warning.pressedBackground
--dwc-border-color-warning = color:Button.warning.borderColor

# INFO button variant
--dwc-color-info = color:Button.info.background
--dwc-color-on-info-text = color:Button.info.foreground
--dwc-color-info-light = color:Button.info.hoverBackground
--dwc-color-info-dark = color:Button.info.pressedBackground
--dwc-border-color-info = color:Button.info.borderColor
```

Verify every CSS token name exists in `src/main/resources/com/dwc/laf/themes/default-light.css` before adding.

**DwcLookAndFeel.java:** Add a new method `initVariantFocusRingColors(UIDefaults table)` called from `initButtonDefaults()`, after the existing `initFocusRingColor(table)` call. This method loops over the 4 variant names ("success", "danger", "warning", "info") and for each:
1. Reads `--dwc-color-{variant}-h` (IntegerValue) from tokenMap
2. Reads `--dwc-color-{variant}-s` (DimensionValue with %) from tokenMap
3. Reads `--dwc-focus-ring-l` and `--dwc-focus-ring-a` (shared across all variants, same as primary)
4. Calls the existing `hslToColor(hue, saturation, lightness, alpha)` method
5. Stores result as `Component.focusRingColor.{variant}` in UIDefaults (e.g., `Component.focusRingColor.success`)

Also store the existing primary focus ring color as `Component.focusRingColor.primary` (in addition to `Component.focusRingColor`) for the variant lookup to be consistent. Do this inside `initFocusRingColor()` -- after the existing `table.put("Component.focusRingColor", ...)` line, add `table.put("Component.focusRingColor.primary", ...)` with the same color.

The `hslToColor` method is already `private static` in DwcLookAndFeel -- it is accessible from the new method since it is in the same class.
  </action>
  <verify>
`mvn compile -f /Users/beff/_lab/dwclaf/pom.xml` succeeds. Grep token-mapping.properties for "Button.success.background" and "Button.danger.background" to confirm entries exist. Grep DwcLookAndFeel.java for "Component.focusRingColor.success" to confirm variant focus ring setup.
  </verify>
  <done>
token-mapping.properties contains all 20 new variant mapping entries (5 per variant x 4 variants). DwcLookAndFeel computes per-variant focus ring colors from CSS HSL tokens and stores them as Component.focusRingColor.{variant}. Existing --dwc-color-danger mapping is appended (not replaced). Compilation succeeds with no errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Variant-keyed DwcButtonUI refactor and variant-aware DwcButtonBorder</name>
  <files>
    src/main/java/com/dwc/laf/ui/DwcButtonUI.java
    src/main/java/com/dwc/laf/ui/DwcButtonBorder.java
    src/test/java/com/dwc/laf/ui/DwcButtonUITest.java
  </files>
  <action>
**DwcButtonUI.java:** Refactor from boolean `isPrimary` to variant-keyed color resolution:

1. Add a private inner record: `private record VariantColors(Color background, Color foreground, Color hoverBackground, Color pressedBackground, Color focusRingColor) {}`

2. Replace the individual `defaultBackground`/`defaultForeground`/`defaultHoverBackground`/`defaultPressedBackground` fields with a single `Map<String, VariantColors> variantColors` field (use `java.util.HashMap`).

3. In `installDefaults()`, build the variant map by looping over the 6 variant names: `"default", "primary", "success", "danger", "warning", "info"`. For each variant:
   - The UIDefaults prefix for "default" variant is `"Button"` (no variant suffix). The prefix for "primary" is `"Button.default"` (Swing convention: "default button" = primary). For all others, the prefix is `"Button." + variant`.
   - Read: `{prefix}.background`, `{prefix}.foreground`, `{prefix}.hoverBackground`, `{prefix}.pressedBackground`
   - For focus ring: "default" variant uses `UIManager.getColor("Component.focusRingColor")`, "primary" uses `UIManager.getColor("Component.focusRingColor.primary")` (which falls back to `Component.focusRingColor`), others use `UIManager.getColor("Component.focusRingColor." + variant)`
   - Store in map with variant name as key

4. Add a `getVariant(AbstractButton b)` method that reads `b.getClientProperty("dwc.buttonType")` and returns the String variant name. Return `"default"` if null or unrecognized.

5. Replace `resolveBackground(b, boolean primary)` with `resolveBackground(AbstractButton b)` that calls `getVariant(b)`, looks up `VariantColors` from the map, and uses `StateColorResolver.resolve()`. Fall back to the "default" variant's colors if the variant is not in the map.

6. Replace `resolveForeground(b, boolean primary)` with `resolveForeground(AbstractButton b)` that does the same variant lookup.

7. In `paint()`, replace `boolean primary = isPrimary(b)` with `String variant = getVariant(b)`. Use the new `resolveBackground(b)` and `resolveForeground(b)`. For the focus ring (step 6), look up the variant's focus ring color from the `VariantColors` record instead of the single `focusRingColor` field: `VariantColors vc = variantColors.getOrDefault(variant, variantColors.get("default"))` then use `vc.focusRingColor()`.

8. Remove the old `isPrimary()` method and the individual primary color fields.

**DwcButtonBorder.java:** Make the border variant-aware:

1. In `paintBorder()`, after reading `Button.borderColor` as the default border color, check if the component is an AbstractButton and read its `dwc.buttonType` client property.
2. If the variant is non-null and not "default", look up `UIManager.getColor("Button." + variant + ".borderColor")` where variant = the client property value. Special case: if variant is "primary", look up `UIManager.getColor("Button.default.borderColor")` (but this key does not exist in current mappings -- primary buttons in DWC use the primary background as border, which is already `Button.default.background`; so for "primary" variant, read `UIManager.getColor("Button.default.background")` as the border color).

   Actually, simpler approach: For primary, the DWC SCSS sets `--dwc-button-border-color: var(--dwc-button-background)` meaning the border matches the background. Rather than special-casing, just add a `--dwc-color-primary = color:Button.default.borderColor` entry to token-mapping.properties (append to the existing `--dwc-color-primary` line). Then the lookup `"Button." + variant + ".borderColor"` works uniformly for all variants including primary (where variant maps to "default" prefix in UIDefaults).

   Wait -- the variant-to-prefix mapping is in DwcButtonUI. DwcButtonBorder does not have that mapping. Simplest approach: DwcButtonBorder reads the `dwc.buttonType` client property. If it is non-null and non-empty:
   - If "primary": read `UIManager.getColor("Button.default.borderColor")`. If null, fall back to `Button.borderColor`.
   - Otherwise: read `UIManager.getColor("Button." + variant + ".borderColor")`. If null, fall back to `Button.borderColor`.

   This requires adding `color:Button.default.borderColor` to the `--dwc-color-primary` token mapping line (append). The DWC pattern is: variant border color = variant background color. So for primary, `--dwc-color-primary` already has the right color. For success/danger/warning/info, the `--dwc-border-color-{variant}` tokens handle it.

3. Add the `color:Button.default.borderColor` to the `--dwc-color-primary` line in token-mapping.properties (this is part of Task 1's file, so coordinate: just include it in the Task 1 token-mapping changes).

**DwcButtonUITest.java:** Add tests for the 4 new variants:

1. `testSuccessVariantPaintNoError` -- create a JButton, set `dwc.buttonType` to "success", paint to BufferedImage, assertDoesNotThrow.
2. `testDangerVariantPaintNoError` -- same for "danger".
3. `testWarningVariantPaintNoError` -- same for "warning".
4. `testInfoVariantPaintNoError` -- same for "info".
5. `testUnknownVariantFallsBackToDefault` -- set `dwc.buttonType` to "nonexistent", paint should not throw (falls back to default colors).
6. `testVariantColorsDifferFromDefault` -- create two buttons (default and success), paint both to BufferedImages, verify that the center pixel colors differ (proving the variant actually uses different colors). Use `img.getRGB(100, 20)` to sample.
  </action>
  <verify>
`mvn test -f /Users/beff/_lab/dwclaf/pom.xml` passes all tests including the new variant tests. Grep DwcButtonUI.java for "VariantColors" and "variantColors" to confirm refactor. Grep DwcButtonBorder.java for "dwc.buttonType" to confirm variant awareness.
  </verify>
  <done>
DwcButtonUI uses a VariantColors record and Map-based variant lookup instead of boolean isPrimary. DwcButtonBorder reads dwc.buttonType and resolves per-variant border colors. All existing tests pass. 6 new tests cover variant paint smoke tests, unknown variant fallback, and variant color differentiation. `mvn test` reports 0 failures.
  </done>
</task>

</tasks>

<verification>
1. `mvn test -f /Users/beff/_lab/dwclaf/pom.xml` -- all tests pass (0 failures)
2. `mvn compile -f /Users/beff/_lab/dwclaf/pom.xml` -- clean compilation
3. token-mapping.properties contains Button.success.*, Button.danger.*, Button.warning.*, Button.info.* entries
4. DwcLookAndFeel stores Component.focusRingColor.success/danger/warning/info in UIDefaults
5. DwcButtonUI uses VariantColors record + Map instead of boolean isPrimary
6. DwcButtonBorder resolves per-variant border color via dwc.buttonType
7. Existing primary and default button behavior is unchanged (regression tests pass)
</verification>

<success_criteria>
- All 4 button variants resolve their colors from the correct CSS semantic tokens through UIDefaults
- Per-variant focus ring colors are computed from variant-specific HSL hue/saturation tokens
- DwcButtonBorder paints variant-specific border colors
- All existing tests continue to pass (no regressions in default/primary behavior)
- 6+ new tests cover variant rendering
</success_criteria>

<output>
After completion, create `.planning/phases/09-button-theme-variants-custom-css-themes/09-01-SUMMARY.md`
</output>
