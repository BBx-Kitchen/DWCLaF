---
phase: 10-more-controls
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/main/resources/com/dwc/laf/token-mapping.properties
  - src/main/java/com/dwc/laf/DwcLookAndFeel.java
  - src/main/java/com/dwc/laf/ui/DwcScrollBarUI.java
  - src/main/java/com/dwc/laf/ui/DwcTreeUI.java
  - src/main/java/com/dwc/laf/ui/DwcTreeExpandIcon.java
  - src/test/java/com/dwc/laf/ui/DwcScrollBarUITest.java
  - src/test/java/com/dwc/laf/ui/DwcTreeUITest.java
autonomous: true

must_haves:
  truths:
    - "JScrollBar renders as a thin modern scrollbar with no arrow buttons"
    - "JScrollBar thumb changes color on hover"
    - "JTree uses custom chevron expand/collapse icons instead of default triangles"
    - "JTree selected nodes show themed highlight with primary color"
  artifacts:
    - path: "src/main/java/com/dwc/laf/ui/DwcScrollBarUI.java"
      provides: "Thin scrollbar UI delegate with custom thumb/track painting"
      exports: ["createUI"]
    - path: "src/main/java/com/dwc/laf/ui/DwcTreeUI.java"
      provides: "Tree UI delegate with selection styling"
      exports: ["createUI"]
    - path: "src/main/java/com/dwc/laf/ui/DwcTreeExpandIcon.java"
      provides: "Custom chevron expand/collapse Icon for tree nodes"
      exports: ["paintIcon", "getIconWidth", "getIconHeight"]
  key_links:
    - from: "DwcLookAndFeel.java"
      to: "DwcScrollBarUI"
      via: "initClassDefaults ScrollBarUI registration"
      pattern: 'table.put\("ScrollBarUI"'
    - from: "DwcLookAndFeel.java"
      to: "DwcTreeUI"
      via: "initClassDefaults TreeUI registration"
      pattern: 'table.put\("TreeUI"'
    - from: "DwcLookAndFeel.java"
      to: "DwcTreeExpandIcon"
      via: "initTreeDefaults installs expand/collapse icons"
      pattern: "Tree.expandedIcon.*DwcTreeExpandIcon"
    - from: "DwcScrollBarUI.java"
      to: "PaintUtils"
      via: "Thumb painting uses rounded shapes"
      pattern: "PaintUtils.createRoundedShape"
---

<objective>
Implement JScrollBar and JTree UI delegates -- the two moderate-complexity components.

Purpose: JScrollBar provides the modern thin scrollbar look (critical since the gallery already uses a JScrollPane). JTree provides themed node selection and custom expand/collapse icons.

Output: Two functional themed components registered in DwcLookAndFeel with tests.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-more-controls/10-RESEARCH.md
@.planning/phases/10-more-controls/10-01-SUMMARY.md
@src/main/java/com/dwc/laf/DwcLookAndFeel.java
@src/main/java/com/dwc/laf/painting/PaintUtils.java
@src/main/java/com/dwc/laf/painting/FocusRingPainter.java
@src/main/resources/com/dwc/laf/token-mapping.properties
@src/test/java/com/dwc/laf/ui/DwcButtonUITest.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: DwcScrollBarUI with thin modern track and hover thumb</name>
  <files>
    src/main/resources/com/dwc/laf/token-mapping.properties
    src/main/java/com/dwc/laf/DwcLookAndFeel.java
    src/main/java/com/dwc/laf/ui/DwcScrollBarUI.java
    src/test/java/com/dwc/laf/ui/DwcScrollBarUITest.java
  </files>
  <action>
    1. **Token mappings** in `token-mapping.properties`:
       - Append to `--dwc-color-default-dark` line: `, color:ScrollBar.thumbColor`
       - Append to `--dwc-color-default` line: `, color:ScrollBar.trackColor`
       - Append to `--dwc-color-primary-light` line: `, color:ScrollBar.hoverThumbColor`

    2. **DwcScrollBarUI.java** -- extending BasicScrollBarUI:
       - `public static ComponentUI createUI(JComponent c)` returning `new DwcScrollBarUI()`
       - Private fields: `Color thumbColor`, `Color hoverThumbColor`, `Color trackColor`, `int thumbArc`, `int scrollBarWidth`
       - `installDefaults()`:
         - Call `super.installDefaults()`
         - Cache colors: `thumbColor = UIManager.getColor("ScrollBar.thumbColor")`, `hoverThumbColor = UIManager.getColor("ScrollBar.hoverThumbColor")`, `trackColor = UIManager.getColor("ScrollBar.trackColor")`
         - `thumbArc = UIManager.getInt("ScrollBar.thumbArc")` (fallback 8)
         - `scrollBarWidth = UIManager.getInt("ScrollBar.width")` (fallback 10)
       - **Zero-size arrow buttons** (FlatLaf pattern):
         - `createDecreaseButton(int orientation)`: return `createZeroButton()`
         - `createIncreaseButton(int orientation)`: return `createZeroButton()`
         - `private JButton createZeroButton()`: create a JButton with preferred/min/max size = Dimension(0,0), `setFocusable(false)`, return it
       - `getMinimumThumbSize()`:
         - Return `new Dimension(scrollBarWidth, 20)` for vertical, `new Dimension(20, scrollBarWidth)` for horizontal
         - Detect orientation via `scrollbar.getOrientation()` -- `scrollbar` is a protected field from BasicScrollBarUI
       - `getPreferredSize(JComponent c)`:
         - For vertical: return `new Dimension(scrollBarWidth, super.getPreferredSize(c).height)`
         - For horizontal: return `new Dimension(super.getPreferredSize(c).width, scrollBarWidth)`
       - `paintTrack(Graphics g, JComponent c, Rectangle trackBounds)`:
         - `Graphics2D g2 = (Graphics2D) g.create()` in try-finally
         - Paint subtle track background: `g2.setColor(trackColor != null ? trackColor : c.getBackground())`, `g2.fill(trackBounds)`
         - Note: track is just a flat fill, no rounded corners needed for the track itself
       - `paintThumb(Graphics g, JComponent c, Rectangle thumbBounds)`:
         - If `thumbBounds.isEmpty()` or `!c.isEnabled()`: return
         - `Graphics2D g2 = (Graphics2D) g.create()` in try-finally
         - `Object[] saved = PaintUtils.setupPaintingHints(g2)`
         - Choose color: `Color tc = isThumbRollover() ? hoverThumbColor : thumbColor` -- `isThumbRollover()` is a protected method from BasicScrollBarUI
         - If tc is null, fallback to `Color.GRAY`
         - Inset the thumb by 3px from track edges for thin look:
           - `int inset = 3`
           - `g2.setColor(tc)`
           - `g2.fill(PaintUtils.createRoundedShape(thumbBounds.x + inset, thumbBounds.y + inset, thumbBounds.width - inset * 2, thumbBounds.height - inset * 2, thumbArc))`
         - `PaintUtils.restorePaintingHints(g2, saved)`
       - `paintDecreaseHighlight(Graphics g)`: no-op (empty method)
       - `paintIncreaseHighlight(Graphics g)`: no-op (empty method)

    3. **DwcLookAndFeel.java** changes:
       - In `initClassDefaults()`: add `table.put("ScrollBarUI", "com.dwc.laf.ui.DwcScrollBarUI")`
       - In `initComponentDefaults()`: add call to `initScrollBarDefaults(table)`
       - Create `private void initScrollBarDefaults(UIDefaults table)`:
         - `table.put("ScrollBar.thumbArc", 8)`
         - `table.put("ScrollBar.width", 10)`
         - Log

    4. **DwcScrollBarUITest.java**:
       - Save/restore L&F
       - `testUIInstalled()`: create JScrollBar, assert `getUI() instanceof DwcScrollBarUI`
       - `testPerComponentInstance()`: two scrollbars have different UI instances
       - `testThinWidth()`: JScrollBar preferred size width <= 10 for vertical orientation
       - `testPaintNoError()`: set size, paint to BufferedImage without exception
       - `testPaintHorizontalNoError()`: JScrollBar(JScrollBar.HORIZONTAL), paint without exception
       - `testMinimumThumbSize()`: call `((DwcScrollBarUI) sb.getUI())` -- actually, getMinimumThumbSize is protected. Instead, test indirectly: scrollbar with very large range still renders (paint smoke test with model max=10000)
  </action>
  <verify>
    `cd /Users/beff/_lab/dwclaf && mvn test -pl . -Dtest="DwcScrollBarUITest" -q` passes all tests.
    Grep confirms registration: `grep "ScrollBarUI" src/main/java/com/dwc/laf/DwcLookAndFeel.java`
  </verify>
  <done>
    JScrollBar renders as thin 10px bar with no arrow buttons, rounded thumb with hover color change, and subtle track background. All tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: DwcTreeUI + DwcTreeExpandIcon with chevron icons and selection styling</name>
  <files>
    src/main/resources/com/dwc/laf/token-mapping.properties
    src/main/java/com/dwc/laf/DwcLookAndFeel.java
    src/main/java/com/dwc/laf/ui/DwcTreeUI.java
    src/main/java/com/dwc/laf/ui/DwcTreeExpandIcon.java
    src/test/java/com/dwc/laf/ui/DwcTreeUITest.java
  </files>
  <action>
    1. **Token mappings** in `token-mapping.properties`:
       - Append to `--dwc-color-default-dark` line: `, color:Tree.expandedIcon.color`
       - Append to `--dwc-color-primary` line: `, color:Tree.selectionBackground`
       - Append to `--dwc-color-on-primary-text` line: `, color:Tree.selectionForeground`
       - Append to `--dwc-color-body-text` line: `, color:Tree.foreground`
       - Append to `--dwc-color-white` line: `, color:Tree.background`

    2. **DwcTreeExpandIcon.java** -- custom Icon for expand/collapse:
       - Implements `javax.swing.Icon`
       - Constructor takes `boolean expanded`
       - Constants: `SIZE = 12` (icon dimensions)
       - `paintIcon(Component c, Graphics g, int x, int y)`:
         - `Graphics2D g2 = (Graphics2D) g.create()` in try-finally
         - `Object[] saved = PaintUtils.setupPaintingHints(g2)`
         - Get color: `UIManager.getColor("Tree.expandedIcon.color")`, fallback `Color.DARK_GRAY`
         - `g2.setColor(color)`
         - Compute center: `cx = x + SIZE / 2f`, `cy = y + SIZE / 2f`
         - `float arrowSize = 5f`
         - Build `Path2D.Float arrow`:
           - If expanded (downward chevron): moveTo(cx - arrowSize/2, cy - arrowSize/4), lineTo(cx, cy + arrowSize/4), lineTo(cx + arrowSize/2, cy - arrowSize/4)
           - If collapsed (rightward chevron): moveTo(cx - arrowSize/4, cy - arrowSize/2), lineTo(cx + arrowSize/4, cy), lineTo(cx - arrowSize/4, cy + arrowSize/2)
         - `g2.setStroke(new BasicStroke(1.5f, BasicStroke.CAP_ROUND, BasicStroke.JOIN_ROUND))`
         - `g2.draw(arrow)` (stroked chevron, not filled)
         - Restore hints, dispose g2
       - `getIconWidth()`: return SIZE
       - `getIconHeight()`: return SIZE

    3. **DwcTreeUI.java** -- extending BasicTreeUI:
       - `public static ComponentUI createUI(JComponent c)` returning `new DwcTreeUI()`
       - Private fields: `Color selectionBackground`, `Color selectionForeground`, `Color foreground`, `Color background`
       - `installDefaults()`:
         - Call `super.installDefaults()`
         - Cache colors from UIManager
         - Install custom icons: `setExpandedIcon(new DwcTreeExpandIcon(true))`, `setCollapsedIcon(new DwcTreeExpandIcon(false))` -- these are protected methods from BasicTreeUI
         - Set `tree.setRowHeight(24)` if UIManager has `Tree.rowHeight`, else 24
       - `paintRow(Graphics g, Rectangle clipBounds, Insets insets, Rectangle bounds, TreePath path, int row, boolean isExpanded, boolean hasBeenExpanded, boolean isLeaf)`:
         - If path is selected (check `tree.isPathSelected(path)`):
           - `Graphics2D g2 = (Graphics2D) g.create()` in try-finally
           - `g2.setColor(selectionBackground != null ? selectionBackground : UIManager.getColor("Tree.selectionBackground"))`
           - Paint full-width selection bar: `g2.fillRect(0, bounds.y, tree.getWidth(), bounds.height)` -- full-width selection highlight (modern look, not just text width)
           - `g2.dispose()`
         - Call `super.paintRow(g, clipBounds, insets, bounds, path, row, isExpanded, hasBeenExpanded, isLeaf)` -- lets BasicTreeUI paint the node content on top of our selection background

    4. **DwcLookAndFeel.java** changes:
       - In `initClassDefaults()`: add `table.put("TreeUI", "com.dwc.laf.ui.DwcTreeUI")`
       - In `initComponentDefaults()`: add call to `initTreeDefaults(table)`
       - Create `private void initTreeDefaults(UIDefaults table)`:
         - `table.put("Tree.expandedIcon", new DwcTreeExpandIcon(true))`
         - `table.put("Tree.collapsedIcon", new DwcTreeExpandIcon(false))`
         - `table.put("Tree.rowHeight", 24)`
         - `table.put("Tree.showsRootHandles", Boolean.TRUE)`
         - `table.put("Tree.paintLines", Boolean.FALSE)` -- no connecting lines for modern look
         - Log

    5. **DwcTreeUITest.java**:
       - Save/restore L&F
       - `testUIInstalled()`: create JTree, assert `getUI() instanceof DwcTreeUI`
       - `testPerComponentInstance()`: two trees have different UI instances
       - `testRowHeight()`: tree.getRowHeight() should be 24
       - `testExpandedIconIsCustom()`: `UIManager.getIcon("Tree.expandedIcon") instanceof DwcTreeExpandIcon`
       - `testCollapsedIconIsCustom()`: same for collapsed
       - `testExpandIconDimensions()`: icon width and height are 12
       - `testPaintNoError()`: create JTree with sample model, setSize, paint to BufferedImage
       - `testPaintWithSelectionNoError()`: create JTree, select row 0, paint to BufferedImage
  </action>
  <verify>
    `cd /Users/beff/_lab/dwclaf && mvn test -pl . -Dtest="DwcTreeUITest" -q` passes all tests.
    `cd /Users/beff/_lab/dwclaf && mvn test -q` -- full suite still passes.
  </verify>
  <done>
    JTree uses DwcTreeUI with custom chevron expand/collapse icons, full-width primary-colored selection highlighting, and 24px row height. No connecting lines. Eight tests pass. Full test suite green.
  </done>
</task>

</tasks>

<verification>
- `mvn test -q` passes all tests (existing + tooltip + progress bar + scrollbar + tree)
- `grep "ScrollBarUI\|TreeUI" src/main/java/com/dwc/laf/DwcLookAndFeel.java` shows both registered
- Token-mapping.properties has ScrollBar and Tree color entries
- DwcTreeExpandIcon renders stroked chevrons (not filled triangles)
</verification>

<success_criteria>
- DwcScrollBarUI installed with thin track, rounded thumb, hover color, and no arrow buttons
- DwcTreeUI installed with chevron icons, full-width selection, and 24px row height
- All new tests pass, all existing tests pass
- Both components registered in DwcLookAndFeel.initClassDefaults()
</success_criteria>

<output>
After completion, create `.planning/phases/10-more-controls/10-02-SUMMARY.md`
</output>
