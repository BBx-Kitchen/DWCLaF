---
phase: 11-visual-details
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java
autonomous: true

must_haves:
  truths:
    - "ComboBox arrow button has a 1px separator line between display area and chevron"
    - "ComboBox chevron is smaller and more subtle than current rendering"
    - "ComboBox arrow button width is reduced from 32px to ~24px"
    - "ComboBox overall proportions match DWC web combobox appearance"
  artifacts:
    - path: "src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java"
      provides: "Reworked arrow button with separator line and compact chevron"
      contains: "DwcComboBoxArrowButton"
  key_links:
    - from: "src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java"
      to: "UIManager ComboBox.buttonArrowColor"
      via: "separator and chevron color from UIDefaults"
      pattern: "ComboBox\\.buttonArrowColor"
---

<objective>
Rework ComboBox arrow button to match DWC web appearance with thin chevron, 1px separator line, and compact proportions.

Purpose: Close the final rendering gap — the ComboBox arrow area is currently too wide and prominent compared to DWC web. The rework adds the missing separator line, reduces the arrow button width, and makes the chevron proportionally smaller and more subtle.
Output: Updated DwcComboBoxArrowButton inner class with separator line painting and correct sizing.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-visual-details/11-RESEARCH.md
@src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java
@dwc/src/components/dwc-combobox/dwc-combobox.scss
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rework ComboBox arrow button — separator, chevron, proportions</name>
  <files>
    src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java
  </files>
  <action>
    Rework the `DwcComboBoxArrowButton` inner class in `DwcComboBoxUI.java` to match DWC web combobox suffix area. Reference DWC SCSS: `dwc/src/components/dwc-combobox/dwc-combobox.scss` lines 56-69.

    **1. Reduce arrow button width:**
    - Change `getPreferredSize()` from `new Dimension(32, 32)` to `new Dimension(24, 24)`.
    - DWC suffix-icon has `padding: var(--dwc-space-xs)` (4px) on all sides. A 24px button gives ~16px content area minus padding, which matches the DWC icon area proportions.

    **2. Paint 1px separator line:**
    - In `paintComponent()`, BEFORE drawing the chevron, paint a 1px vertical separator line on the left edge of the arrow button.
    - DWC SCSS: `[part='suffix-separator']` has `background-color: var(--dwc-color-default-dark)`, `width: 1px`, `margin: var(--dwc-space-xs) 0` (4px top/bottom inset).
    - Get separator color from `UIManager.getColor("ComboBox.buttonArrowColor")` (already mapped from `--dwc-color-default-dark`) — this is the same token DWC uses for the separator.
    - Draw: `g2.fillRect(0, 4, 1, getHeight() - 8)` — 1px wide, inset 4px from top and bottom.
    - Use the separator color at reduced opacity (alpha ~128, approximately 50%) for subtlety, or use the color directly if it's already a light gray (check: `--dwc-color-default-dark` is `hsl(211, 38%, 85%)` which is a light gray — use directly without opacity reduction).

    **3. Shrink and center chevron:**
    - Reduce `arrowSize` from `8f` to `6f` for a smaller, more subtle chevron matching DWC's compact icon.
    - The chevron center point calculation (`cx = w/2f`, `cy = h/2f`) stays the same but the smaller arrowSize will naturally produce a more compact shape.
    - Reduce stroke width from `1.5f` to `1.2f` for a thinner, more subtle line.

    **4. Verify display area is not clipped:**
    - After changing arrow button preferred size from 32 to 24, the display area (where selected value text renders) gains 8 more pixels. This is fine — `BasicComboBoxUI` computes display area as `comboBox.width - arrowButton.preferredSize.width - insets`. The wider display area is actually an improvement.
    - No changes needed to `paintCurrentValue` or `getPreferredSize` on the outer class.

    **5. Verify disabled state rendering:**
    - The separator line and chevron should both be visible in disabled state. The `DwcComboBoxUI.paint()` method wraps the entire paint in `StateColorResolver.paintWithOpacity()` when disabled, which will naturally reduce the separator and chevron opacity. No special disabled handling needed in the arrow button.
  </action>
  <verify>
    - `mvn compile -q` succeeds with no errors.
    - `grep "Dimension(24" src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java` confirms reduced button width.
    - `grep "fillRect\|separator\|1px" src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java` confirms separator line painting.
    - `grep "arrowSize = 6" src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java` confirms reduced chevron size.
  </verify>
  <done>
    ComboBox arrow button renders with: (1) 24px width (down from 32px), (2) 1px vertical separator line inset 4px from top/bottom on the left edge colored with --dwc-color-default-dark, (3) smaller 6px chevron with 1.2f stroke width. The overall appearance matches DWC web combobox with subtle, compact suffix area. Display area text is not clipped. Disabled state renders correctly with reduced opacity.
  </done>
</task>

</tasks>

<verification>
1. `mvn compile -q` succeeds with zero errors.
2. Run gallery (`mvn compile exec:java`) and visually confirm:
   - ComboBox has a visible 1px separator line between display area and arrow
   - Chevron is smaller and more subtle than before
   - Arrow button area is narrower (24px vs previous 32px)
   - Selected value text is not clipped — display area has adequate width
   - Disabled ComboBox shows separator and chevron at reduced opacity
   - ComboBox popup still opens/closes correctly
3. All existing tests pass: `mvn test -q`
</verification>

<success_criteria>
- Arrow button preferred width is 24px (not 32px)
- 1px separator line is painted on the left edge of the arrow button with 4px top/bottom inset
- Chevron arrowSize is 6f (not 8f) with 1.2f stroke width
- ComboBox text display area is not clipped
- No regressions in ComboBox interaction (popup, selection, keyboard nav)
</success_criteria>

<output>
After completion, create `.planning/phases/11-visual-details/11-02-SUMMARY.md`
</output>
