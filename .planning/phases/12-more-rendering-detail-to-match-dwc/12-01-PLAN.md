---
phase: 12-more-rendering-detail-to-match-dwc
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/resources/com/dwc/laf/token-mapping.properties
  - src/main/java/com/dwc/laf/DwcLookAndFeel.java
autonomous: true

must_haves:
  truths:
    - "Default button shows dark text (black) on light gray background, not white-on-gray"
    - "Primary button shows white text on blue background"
    - "All colored variant buttons (success, danger, warning, info) show white text"
    - "Default button border is subtle gray, not bright blue"
    - "Colored variant button borders match their background color (barely visible)"
    - "Button text appears heavier/bolder than body text (semi-bold equivalent)"
  artifacts:
    - path: "src/main/resources/com/dwc/laf/token-mapping.properties"
      provides: "Corrected token mappings without collision between default and variant values"
      contains: "--dwc-color-on-default-text"
    - path: "src/main/java/com/dwc/laf/DwcLookAndFeel.java"
      provides: "Button font derived as BOLD from default font"
      contains: "Font.BOLD"
  key_links:
    - from: "token-mapping.properties"
      to: "DwcButtonUI variant color resolution"
      via: "UIDefaults Button.foreground populated from --dwc-color-on-default-text only"
      pattern: "--dwc-color-on-default-text.*Button\\.foreground"
    - from: "DwcLookAndFeel.initButtonDefaults"
      to: "Button.font in UIDefaults"
      via: "deriveFont with Font.BOLD"
      pattern: "Font\\.BOLD"
---

<objective>
Fix the critical token-mapping collisions that cause incorrect button foreground and border colors, and add bold font derivation for button text weight.

Purpose: The most visible rendering mismatch is the default button showing white text (nearly invisible) on a light gray background. This is caused by a token-mapping collision where `--dwc-button-color` (flattened to the primary variant's white value) overwrites `Button.foreground`. Similarly, `--dwc-button-border-color` flattens to the primary blue, making the default button border bright blue instead of subtle gray. Button text also appears too thin (PLAIN) when DWC uses font-weight 500 (semi-bold).

Output: Corrected token-mapping.properties and DwcLookAndFeel.java with bold button font
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-more-rendering-detail-to-match-dwc/12-RESEARCH.md
@src/main/resources/com/dwc/laf/token-mapping.properties
@src/main/java/com/dwc/laf/DwcLookAndFeel.java
@src/main/java/com/dwc/laf/ui/DwcButtonUI.java
@src/main/java/com/dwc/laf/ui/DwcButtonBorder.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix token-mapping collisions for button foreground and border colors</name>
  <files>src/main/resources/com/dwc/laf/token-mapping.properties</files>
  <action>
Fix two critical token-mapping collisions caused by CSS flattening:

**Collision 1: Button foreground color**
The line `--dwc-button-color = color:Button.foreground` (line 44) overwrites the correct value set by `--dwc-color-on-default-text = color:Button.foreground` (line 16). The CSS parser flattens `--dwc-button-color` to the primary variant's white value (because `.dwc-button[theme='primary']` block comes after `.dwc-button` block in the CSS).

Fix: Remove `color:Button.foreground` from the `--dwc-button-color` mapping line entirely. If `--dwc-button-color` has no other targets, remove or comment out the entire line. The default button foreground will then come solely from `--dwc-color-on-default-text` which resolves to black. The primary button foreground is already correctly mapped via `--dwc-color-on-primary-text = color:Button.default.foreground`.

**Collision 2: Button border color**
The line `--dwc-button-border-color = color:Button.borderColor` (line 46) flattens to the primary variant's border color (blue) because `.dwc-button[theme='primary']` overrides `--dwc-button-border-color` to match the primary background. This makes the default button border bright blue instead of subtle gray.

Fix: Remove the `--dwc-button-border-color = color:Button.borderColor` line entirely. Instead, add `color:Button.borderColor` to the existing `--dwc-color-default` mapping line (line 15). The `--dwc-color-default` token resolves to the neutral gray that DWC uses for the default button background AND border. This gives the default button a subtle same-color-as-background border, matching DWC exactly.

After changes, the `--dwc-color-default` line should include `color:Button.borderColor` at the end of its comma-separated list. The `--dwc-button-font-weight` line can remain (it puts an int into UIDefaults but is harmless). The `--dwc-button-hover-background` line can also remain.

Keep all other existing mappings unchanged.
  </action>
  <verify>
Run `mvn compile -f /Users/beff/_lab/dwclaf/pom.xml` to verify the properties file is valid and the project compiles. Then grep the token-mapping.properties file to confirm:
1. No line contains both `--dwc-button-color` and `Button.foreground`
2. No line contains both `--dwc-button-border-color` and `Button.borderColor`
3. The `--dwc-color-default` line contains `Button.borderColor`
4. The `--dwc-color-on-default-text` line still contains `Button.foreground`
  </verify>
  <done>
Default button foreground mapped from --dwc-color-on-default-text (black) only. Default button border mapped from --dwc-color-default (gray). No collision with variant-flattened tokens.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add bold font derivation for button text</name>
  <files>src/main/java/com/dwc/laf/DwcLookAndFeel.java</files>
  <action>
In `DwcLookAndFeel.initButtonDefaults(UIDefaults table)`, after the existing setup code (rollover, margin, border, etc.), add button font derivation:

1. Get the `defaultFont` from UIDefaults (already populated by `initDefaultFont()` which runs before `initButtonDefaults()`).
2. If the default font exists, create a new `FontUIResource` with the same family and size but `Font.BOLD` style.
3. Put it into UIDefaults as `Button.font`.

This maps DWC's `--dwc-button-font-weight: 500` (semi-bold) to Java's nearest equivalent (BOLD). The existing `initDefaultFont()` sets `Button.font` to the default PLAIN font; this override replaces it with BOLD specifically for buttons.

Code to add in `initButtonDefaults()` after the border setup (before the LOG.fine line):

```java
// 7. Button font weight: DWC uses font-weight 500 (semibold).
// Java Font has no semi-bold; use BOLD as nearest equivalent.
FontUIResource defaultFont = (FontUIResource) table.get("defaultFont");
if (defaultFont != null) {
    FontUIResource buttonFont = new FontUIResource(
        defaultFont.getFamily(), Font.BOLD, defaultFont.getSize());
    table.put("Button.font", buttonFont);
}
```

Update the LOG.fine message to include "font" in the list of initialized defaults.

Do NOT change font for TextField, ComboBox, or other components in this task -- body text and input text should remain PLAIN per DWC's `--dwc-font-weight: 400`.
  </action>
  <verify>
Run `mvn compile -f /Users/beff/_lab/dwclaf/pom.xml` to confirm compilation succeeds. Verify that `initButtonDefaults` contains `Font.BOLD` and creates a `FontUIResource` for `Button.font`.
  </verify>
  <done>
Button font set to BOLD style in UIDefaults, giving buttons heavier text weight matching DWC semi-bold appearance. Body text and input text remain PLAIN.
  </done>
</task>

</tasks>

<verification>
1. `mvn compile -f /Users/beff/_lab/dwclaf/pom.xml` succeeds with no errors
2. `mvn test -f /Users/beff/_lab/dwclaf/pom.xml` passes all existing tests
3. token-mapping.properties has no `--dwc-button-color` mapping to `Button.foreground`
4. token-mapping.properties has no `--dwc-button-border-color` mapping to `Button.borderColor`
5. `--dwc-color-default` mapping includes `Button.borderColor`
6. `initButtonDefaults()` derives a BOLD font and stores as `Button.font`
</verification>

<success_criteria>
Default buttons render with black text on gray background (not white text). Colored variant buttons retain white text. Default button border is subtle gray. Button text is bold weight. All existing tests pass.
</success_criteria>

<output>
After completion, create `.planning/phases/12-more-rendering-detail-to-match-dwc/12-01-SUMMARY.md`
</output>
