---
phase: 12-more-rendering-detail-to-match-dwc
plan: 03
type: execute
wave: 2
depends_on: ["12-01", "12-02"]
files_modified:
  - src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java
  - src/main/java/com/dwc/laf/DwcLookAndFeel.java
autonomous: true

must_haves:
  truths:
    - "ComboBox text renders with semi-bold (BOLD) font weight matching DWC input weight"
    - "ComboBox overall appearance is crisp with thin 1px border (inherits from Plan 02 border fix)"
    - "ComboBox arrow chevron and separator are proportionally sized and cleanly rendered"
    - "TextField remains fully flat with no sunken/3D appearance"
  artifacts:
    - path: "src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java"
      provides: "Refined ComboBox with correct font weight and tuned proportions"
      contains: "DwcComboBoxArrowButton"
    - path: "src/main/java/com/dwc/laf/DwcLookAndFeel.java"
      provides: "ComboBox font set to BOLD for semi-bold appearance"
      contains: "ComboBox.font"
  key_links:
    - from: "DwcLookAndFeel.initComboBoxDefaults"
      to: "ComboBox.font in UIDefaults"
      via: "deriveFont with Font.BOLD"
      pattern: "ComboBox\\.font"
    - from: "DwcComboBoxUI.DwcComboBoxArrowButton"
      to: "PaintUtils.setupPaintingHints"
      via: "crisp chevron rendering"
      pattern: "setupPaintingHints"
---

<objective>
Refine ComboBox rendering to match DWC web appearance with correct font weight, tuned proportions, and overall visual crispness.

Purpose: The ComboBox is described as looking substantially different from DWC. Phase 11 reworked the arrow button with a separator and chevron, and Plan 01/02 fix font weight and border crispness respectively. This plan applies font weight to the ComboBox text and fine-tunes the arrow button proportions and separator to close the remaining visual gap. Also verifies TextField flatness is maintained after the border crispness changes.

Output: Refined DwcComboBoxUI matching DWC visual closely, ComboBox font set to BOLD
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-more-rendering-detail-to-match-dwc/12-RESEARCH.md
@.planning/phases/12-more-rendering-detail-to-match-dwc/12-01-SUMMARY.md
@.planning/phases/12-more-rendering-detail-to-match-dwc/12-02-SUMMARY.md
@src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java
@src/main/java/com/dwc/laf/DwcLookAndFeel.java
@src/main/java/com/dwc/laf/ui/DwcTextFieldUI.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ComboBox font weight and tune arrow button proportions</name>
  <files>
    src/main/java/com/dwc/laf/DwcLookAndFeel.java
    src/main/java/com/dwc/laf/ui/DwcComboBoxUI.java
  </files>
  <action>
**Part A: ComboBox font weight (DwcLookAndFeel.java)**

In `initComboBoxDefaults(UIDefaults table)`, add font weight derivation similar to the button font from Plan 01. DWC input fields use `--dwc-input-font-weight: var(--dwc-font-weight-semibold)` = 500, which should map to BOLD in Java.

After the existing ComboBox border and padding setup, add:
```java
// ComboBox font weight: DWC inputs use font-weight 500 (semibold).
// Java Font has no semi-bold; use BOLD as nearest equivalent.
FontUIResource defaultFont = (FontUIResource) table.get("defaultFont");
if (defaultFont != null) {
    FontUIResource comboFont = new FontUIResource(
        defaultFont.getFamily(), Font.BOLD, defaultFont.getSize());
    table.put("ComboBox.font", comboFont);
}
```

Update the LOG.fine message to include "font" in the list.

NOTE: Do NOT apply BOLD to TextField.font. The research (Finding 3) mentions `--dwc-input-font-weight` is semibold, but the user's locked decision specifically calls out button text, label text, section headers, and body text for review. TextField text in DWC actually uses the base input styling which visually appears closer to normal weight. ComboBox gets BOLD because it renders like a button/selector. If the user later wants TextField bold, that is a separate change.

**Part B: ComboBox arrow button proportion tuning (DwcComboBoxUI.java)**

Review and refine the `DwcComboBoxArrowButton` inner class for closer DWC match:

1. The arrow button preferred width of 24px is reasonable for DWC's compact suffix area. Keep it.

2. The separator line uses `fillRect(0, 4, 1, h - 8)` which is a 1px line inset 4px top/bottom. This matches DWC's `margin: var(--dwc-space-xs) 0` where `--dwc-space-xs` = 4px. Keep this.

3. The chevron arrow size of 6f and stroke width of 1.2f produce a compact chevron. Verify these proportions look good. If the chevron appears too small or too large compared to DWC:
   - DWC uses a CSS chevron that is approximately 5-6px in size.
   - The current 6px is correct. Keep it.

4. Ensure the separator line color reads from `ComboBox.buttonArrowColor` which maps from `--dwc-color-default-dark` (a light gray). This is already in place.

5. The overall ComboBox height is enforced at 36px minimum via `getPreferredSize`/`getMinimumSize`. This matches DWC's `--dwc-size-m = 2.25rem = 36px`. Keep this.

The main change in this task is the font weight. The proportions from Phase 11 are already close to DWC. The border crispness improvement from Plan 02 will further improve the visual match. If after visual inspection the chevron or separator needs adjustment, make minor tweaks to arrowSize (range 5-7) or stroke width (range 1.0-1.5).
  </action>
  <verify>
Run `mvn compile -f /Users/beff/_lab/dwclaf/pom.xml` to confirm compilation. Run `mvn test -f /Users/beff/_lab/dwclaf/pom.xml` to verify no tests break. Verify that `initComboBoxDefaults` contains `Font.BOLD` and `ComboBox.font`.
  </verify>
  <done>
ComboBox text renders with bold font weight matching DWC's semi-bold input styling. Arrow button proportions confirmed matching DWC web appearance. Overall ComboBox visually matches DWC with thin crisp border, flat background, small chevron, and subtle separator.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify TextField flatness and overall integration</name>
  <files>src/main/java/com/dwc/laf/DwcLookAndFeel.java</files>
  <action>
Verify that the TextField remains fully flat after the border crispness changes from Plan 02:

1. The TextField background uses `--dwc-input-background` which resolves to `hsl(211, 38%, 95%)` -- a very slight blue tint. This is the DWC-correct value (the DWC web version has this same tint). The "sunken" appearance the user described is most likely the border being too soft (now fixed by Plan 02's integer snapping) rather than the background color.

2. Do NOT change TextField.background to pure white -- that would diverge from DWC's actual CSS styling.

3. Confirm `initTextFieldDefaults` does not introduce any shadow, gradient, or 3D effect. The existing code only sets margin and border (DwcTextFieldBorder). The border uses `PaintUtils.paintOutline` with even-odd fill which is inherently flat. This is correct.

4. As a minor refinement, verify that the TextField border arc matches ComboBox arc for visual consistency. Both should use `TextField.arc` and `ComboBox.arc` from the `--dwc-border-radius` token (4px). This is already the case from the existing token mapping.

5. If everything checks out (which it should based on the code analysis), update the LOG.fine message in `initTextFieldDefaults` to note "verified flat rendering" for documentation purposes.

This task is primarily a verification pass. The TextField was already close to correct; the user's "sunken" perception should be resolved by Plan 02's border crispness fix. No substantive code changes expected unless the verification reveals an issue.
  </action>
  <verify>
Run `mvn compile -f /Users/beff/_lab/dwclaf/pom.xml` and `mvn test -f /Users/beff/_lab/dwclaf/pom.xml` to verify no regressions. Run `mvn compile exec:java -f /Users/beff/_lab/dwclaf/pom.xml` to visually verify the gallery (if possible in the environment).
  </verify>
  <done>
TextField confirmed as fully flat with no sunken/3D appearance. Border crispness from Plan 02 produces thin sharp 1px outline. Background tint matches DWC web CSS. All components render with correct visual fidelity.
  </done>
</task>

</tasks>

<verification>
1. `mvn compile -f /Users/beff/_lab/dwclaf/pom.xml` succeeds
2. `mvn test -f /Users/beff/_lab/dwclaf/pom.xml` passes all tests
3. ComboBox.font set to BOLD in UIDefaults
4. TextField rendering remains flat (no shadows, no 3D effects)
5. All 13 component delegates compile and paint correctly
</verification>

<success_criteria>
ComboBox renders with bold text, thin crisp border, flat background, small chevron, and subtle separator matching DWC web appearance. TextField remains fully flat. All existing tests pass. The overall rendering fidelity across buttons, inputs, progress bars, and combo boxes closely matches DWC web counterparts.
</success_criteria>

<output>
After completion, create `.planning/phases/12-more-rendering-detail-to-match-dwc/12-03-SUMMARY.md`
</output>
